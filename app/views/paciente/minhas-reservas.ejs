<!DOCTYPE html>
<html lang="pt-BR">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Instituto Vita</title>
   <link rel="icon" href="/image/logo.png">
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=EB+Garamond&family=Uncial+Antiqua&display=swap"
      rel="stylesheet">
   <link rel="stylesheet" href="/css/paciente/style_minhas_reservas.css">
</head>

<body>
   <!-- ======================================================================================================================-->
   <!--===================================================== MENU ============================================================-->
   <!--====================================================================================================================== -->
   <nav>
      <a href="/" class="img">
         <img src="/image/logo.png" alt="Logo da Empresa" class="img-logo">
      </a>
      <a href="/nav/sobre-nos">Sobre n√≥s</a>
      <a href="/nav/sobre-cancer">Sobre o c√¢ncer</a>
      <a href="/nav/acomodacoes">Acomoda√ß√µes</a>
      <a href="/nav/apoio-paciente">Apoio ao paciente</a>
      <a href="/nav/localizacao">Localiza√ß√µes</a>
      <a href="/perguntas/perguntas-frequentes">Perguntas frequentes</a>
      <% if (!user) { %>
         <a href="/usuarios/login" class="btn-entrar">Entrar</a>
         <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
         <% } else { %>
            <% if (user.tipo==='paciente' ) { %>
               <a href="/paciente/minhas-reservas" class="btn-nav">Minhas Reservas</a>
               <% } else if (user.tipo==='acompanhante' ) { %>
                  <a href="/acompanhante/minhas-acomodacoes" class="btn-nav">Apoio ao Paciente</a>
                  <% } else if (user.tipo==='voluntario' ) { %>
                     <a href="/voluntario/minhas-ajudas" class="btn-nav">√Årea do Volunt√°rios</a>
                     <% } else if (user.tipo==='doador' ) { %>
                        <a href="/doador/minhas-doacoes" class="btn-nav">Minhas Doa√ß√µes</a>
                        <% } else if (user.tipo==='admin' ) { %>
                           <a href="/admin/painel" class="btn-nav">Configura√ß√µes</a>
                           <% } else { %>
                              <a href="/usuarios/login" class="btn-entrar">Entrar</a>
                              <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
                              <% } %>
                                 <a href="/usuarios/logout" class="btn-logout">Sair</a>
                                 <% } %>
   </nav>

   <!-- ======================================================================================================================-->
   <!--=================================================== SIDEBAR ===========================================================-->
   <!--====================================================================================================================== -->
   <div class="painel-container">
      <aside class="sidebar">
         <div class="sidebar-item active" data-target="conta" tabindex="0">
            <span class="icon" aria-hidden="true">üë§</span>
            <span>Minha Conta</span>
         </div>
         <div class="sidebar-item" data-target="reservas" tabindex="0">
            <span class="icon" aria-hidden="true">üìÖ</span>
            <span>Minhas Reservas</span>
         </div>
         <div class="sidebar-item" data-target="saude" tabindex="0">
            <span class="icon" aria-hidden="true">‚ù§Ô∏è</span>
            <span>Perfil de Sa√∫de</span>
         </div>
         <div class="sidebar-item" data-target="historico" tabindex="0">
            <span class="icon" aria-hidden="true">üìú</span>
            <span>Hist√≥rico</span>
         </div>
         <div class="sidebar-item" data-target="documentos" tabindex="0">
            <span class="icon" aria-hidden="true">üìÇ</span>
            <span>Documentos</span>
         </div>
         <div class="sidebar-item" data-target="alimentacao" tabindex="0">
            <span class="icon" aria-hidden="true">üçΩÔ∏è</span>
            <span>Alimenta√ß√£o</span>
         </div>
         <div class="sidebar-item" data-target="avaliacao" tabindex="0">
            <span class="icon" aria-hidden="true">üå∏</span>
            <span>Avalia√ß√£o</span>
         </div>
      </aside>

      <main>
         <!-- ======================================================================================================================-->
         <!--============================================== SECTION MINHA CONTA ====================================================-->
         <!--====================================================================================================================== -->
         <section id="conta" class="conteudo ativo">
            <h2 class="section-title">üë§ Minha Conta</h2>

            <form id="formConta" class="info-form">
               <div class="info-card">
                  <h3 class="section-subtitle">Conta</h3>
                  <div class="campo">
                     <label>Email:</label>
                     <input type="email" name="usuario_email" value="<%= user.email %>" readonly>
                  </div>
               </div>

               <div class="info-card">
                  <h3 class="section-subtitle">Informa√ß√µes Pessoais</h3>
                  <div class="campo">
                     <label>Nome Completo:</label>
                     <input type="text" name="paciente_nome" value="<%= paciente.paciente_nome || '' %>" readonly>
                  </div>

                  <div class="campo-duplo">
                     <div>
                        <label>CPF:</label>
                        <input type="text" name="paciente_cpf" value="<%= paciente.paciente_cpf || '' %>" readonly>
                     </div>
                     <div>
                        <label>RG:</label>
                        <input type="text" name="paciente_rg" value="<%= paciente.paciente_rg || '' %>" readonly>
                     </div>
                  </div>

                  <div class="campo-duplo">
                     <div>
                        <label>Data de Nascimento:</label>
                        <input type="date" name="paciente_data_nascimento"
                           value="<%= paciente.paciente_data_nascimento ? paciente.paciente_data_nascimento.toString().substring(0,10) : '' %>"
                           readonly>
                     </div>
                     <div>
                        <label>Sexo:</label>
                        <input type="text" name="paciente_sexo" value="<%= paciente.paciente_sexo || '' %>" readonly>
                     </div>
                  </div>

                  <div class="campo-duplo">
                     <div>
                        <label>Peso:</label>
                        <input type="text" name="paciente_peso" value="<%= paciente.paciente_peso  || '' %>" readonly>
                     </div>
                     <div>
                        <label>Altura:</label>
                        <input type="text" name="paciente_altura" value="<%= paciente.paciente_altura || '' %>"
                           readonly>
                     </div>
                  </div>

                  <div class="campo">
                     <label>Estado Civil:</label>
                     <input type="text" name="paciente_estado_civil" value="<%= paciente.paciente_estado_civil || '' %>"
                        readonly>
                  </div>

                  <div class="campo">
                     <label>Profiss√£o:</label>
                     <input type="text" name="paciente_profissao" value="<%= paciente.paciente_profissao || '' %>"
                        readonly>
                  </div>



               </div>

               <div class="info-card">
                  <h3 class="section-subtitle">Endere√ßo e Contato</h3>

                  <div class="campo">
                     <label>Telefone:</label>
                     <input type="text" name="paciente_telefone" value="<%= paciente.paciente_telefone || '' %>"
                        readonly>
                  </div>

                  <div class="campo">
                     <label>Endere√ßo:</label>
                     <input type="text" name="paciente_logradouro" value="<%= paciente.paciente_logradouro || '' %>"
                        readonly>
                  </div>

                  <div class="campo-trio">
                     <div>
                        <label>N√∫mero:</label>
                        <input type="text" name="paciente_numero" value="<%= paciente.paciente_numero || '' %>"
                           readonly>
                     </div>
                     <div>
                        <label>Complemento:</label>
                        <input type="text" name="paciente_complemento"
                           value="<%= paciente.paciente_complemento || '' %>" readonly>
                     </div>
                     <div>
                        <label>Bairro:</label>
                        <input type="text" name="paciente_bairro" value="<%= paciente.paciente_bairro || '' %>"
                           readonly>
                     </div>
                     <div>
                        <label>CEP:</label>
                        <input type="text" name="paciente_cep" value="<%= paciente.paciente_cep || '' %>" readonly>
                     </div>
                  </div>

                  <div class="campo-duplo">
                     <div>
                        <label>Cidade:</label>
                        <input type="text" name="paciente_cidade" value="<%= paciente.paciente_cidade || '' %>"
                           readonly>
                     </div>
                     <div>
                        <label>Estado:</label>
                        <input type="text" name="paciente_estado" value="<%= paciente.paciente_estado || '' %>"
                           readonly>
                     </div>
                  </div>
               </div>

               <!-- Bot√£o fixo -->
               <div class="botoes-fixas">
                  <button type="submit" id="btnSalvar" class="btn-success">Salvar Altera√ß√µes</button>
                  <button type="button" class="delete" id="btnExcluir">Excluir Conta</button>
               </div>
            </form>

            <script>
               // Tornar campo edit√°vel ao clicar
               document.querySelectorAll('#formConta input').forEach(input => {
                  input.addEventListener('focus', () => input.removeAttribute('readonly'));
               });

               // Salvamento com confirma√ß√£o
               document.getElementById('formConta').addEventListener('submit', async (e) => {
                  e.preventDefault();
                  if (!confirm('Tem certeza de que deseja salvar estas altera√ß√µes?')) return;

                  const formData = new FormData(e.target);
                  const data = Object.fromEntries(formData.entries());

                  const resp = await fetch('/paciente/atualizar', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(data)
                  });

                  const result = await resp.json();
                  alert(result.mensagem);
                  if (result.ok) location.reload();
               });

               // Exclus√£o
               document.getElementById('btnExcluir').addEventListener('click', async () => {
                  if (!confirm('Tem certeza que deseja excluir sua conta? Esta a√ß√£o n√£o pode ser desfeita.')) return;
                  const resp = await fetch('/paciente/excluir', { method: 'DELETE' });
                  const result = await resp.json();
                  alert(result.mensagem);
                  if (result.ok) window.location.href = '/';
               });
            </script>
         </section>

         <!-- ======================================================================================================================-->
         <!--============================================= SECTION MINHAS RESERVAS =================================================-->
         <!--====================================================================================================================== -->
         <section id="reservas" class="conteudo">
            <h2 class="section-title">Minhas Reservas</h2>
            <a href="/reservas/nova" class="btn">Nova reserva</a>

            <div class="card card-reservas">
               <div class="table-responsive">
                  <table>
                     <thead>
                        <tr>
                           <th>Check-in</th>
                           <th>Check-out</th>
                           <th>Quarto</th>
                           <th>Status</th>
                           <th></th>
                        </tr>
                     </thead>
                     <tbody>
                        <% if (reservas && reservas.length> 0) { %>
                           <% reservas.forEach(r=> { %>
                              <tr>
                                 <td>
                                    <%= new Date(r.reserva_data_checkin_previsto).toLocaleString('pt-BR') %>
                                 </td>
                                 <td>
                                    <%= new Date(r.reserva_data_checkout_previsto).toLocaleString('pt-BR') %>
                                 </td>
                                 <td>
                                    <%= r.quarto_numero %>
                                       <button class="btn-sm btn-secondary" type="button" data-id="<%= r.reserva_id %>"
                                          onclick="abrirModal('<%= r.reserva_id %>')">
                                          Detalhes
                                       </button>
                                 </td>
                                 <td>
                                    <span class="badge badge-<%= 
                                    r.reserva_status === 'confirmada' ? 'success' :
                                    r.reserva_status === 'pendente' ? 'warning' :
                                    r.reserva_status === 'cancelada' ? 'danger' : 'secondary'
                                 %>">
                                       <%= r.reserva_status %>
                                    </span>
                                 </td>
                                 <td class="acoes">
                                    <% if (r.reserva_status !=='cancelada' ) { %>
                                       <button class="btn-sm btn-danger"
                                          onclick="cancelarReserva('<%= r.reserva_id %>')">Cancelar</button>
                                       <% } %>
                                 </td>
                              </tr>
                              <% }) %>
                                 <% } else { %>
                                    <tr>
                                       <td colspan="5">Nenhuma reserva encontrada.</td>
                                    </tr>
                                    <% } %>
                     </tbody>
                  </table>
               </div>
            </div>

            <!-- ============= MODAL COM DETALHES ============= -->
            <div id="modalReserva" class="modal">
               <div class="modal-content">
                  <span class="close" onclick="fecharModal()">&times;</span>
                  <h3>Detalhes da Reserva</h3>
                  <div id="conteudoModal"></div>
               </div>
            </div>

            <script>
               function abrirModal(id) {
                  fetch(`/paciente/reservas/detalhes/${id}`)
                     .then(res => res.json())
                     .then(reserva => {
                        document.getElementById('conteudoModal').innerHTML = `
                           <h3>${reserva.tipo_quarto_nome}</h3>
                           <p>${reserva.tipo_quarto_descricao}</p>

                           <div class="galeria-quarto">
                              ${reserva.fotos && reserva.fotos.length > 0
                              ? reserva.fotos.map(f => `<img src="${f}" class="foto-quarto">`).join('')
                              : '<p>Sem fotos dispon√≠veis.</p>'
                           }
                           </div>

                           <hr>

                           <p><b>Paciente:</b> ${reserva.paciente_nome}</p>
                           <p><b>Acompanhante:</b> ${reserva.acompanhante_nome || 'Nenhum'}</p>
                           <p><b>Quarto:</b> ${reserva.quarto_numero}</p>
                           <p><b>Status:</b> ${reserva.reserva_status}</p>
                           <p><b>Check-in previsto:</b> ${new Date(reserva.reserva_data_checkin_previsto).toLocaleString('pt-BR')}</p>
                           <p><b>Check-out previsto:</b> ${new Date(reserva.reserva_data_checkout_previsto).toLocaleString('pt-BR')}</p>
                           <p><b>Necessidades especiais:</b> ${reserva.reserva_necessidades_especiais || 'Nenhuma'}</p>
                        `;

                        document.getElementById('modalReserva').style.display = 'block';
                     });
               }

               function fecharModal() {
                  document.getElementById('modalReserva').style.display = 'none';
               }

               function cancelarReserva(id) {
                  if (!confirm("Deseja realmente cancelar esta reserva?")) return;
                  fetch(`/paciente/reservas/cancelar/${id}`, { method: "POST" })
                     .then(response => {
                        if (!response.ok) {
                           throw new Error('Erro ao cancelar reserva');
                        }
                        location.reload();
                     })
                     .catch(error => {
                        alert('Erro: ' + error.message);
                     });
               }
            </script>
         </section>

         <!-- ======================================================================================================================-->
         <!--================================================= PERFIL DE SA√öDE =======================================================-->
         <!--====================================================================================================================== -->
         <section id="saude" class="conteudo">
            <h2 class="section-title">Perfil de Sa√∫de</h2>
            <p class="subtitle">Suas informa√ß√µes cl√≠nicas vitais e plano de tratamento atual.</p>

            <div class="painel-dashboard saude-cards">

               <!-- DIAGN√ìSTICO PRINCIPAL -->
               <div class="card card-metricas">
                  <h4 class="card-title">Diagn√≥stico Principal</h4>
                  <p class="value-destaque">
                     <%= paciente.paciente_diagnostico || "N√£o informado" %>
                  </p>

                  <% if (paciente.paciente_fase_tratamento) { %>
                     <span class="badge badge-info">
                        <%= paciente.paciente_fase_tratamento %>
                     </span>
                     <% } %>
               </div>

               <!-- ALERGIAS -->
               <div class="card card-metricas">
                  <h4 class="card-title">Alergias Conhecidas</h4>
                  <p class="value-destaque">
                     <%= paciente.paciente_alergias_risco || "Nenhuma informada" %>
                  </p>

                  <% if (paciente.paciente_alergias_risco) { %>
                     <span class="badge badge-danger">Aten√ß√£o</span>
                     <% } else { %>
                        <span class="badge badge-info">OK</span>
                        <% } %>
               </div>

               <!-- PLANO DE TRATAMENTO -->
               <div class="card card-plano">
                  <h4 class="card-title">Plano de Tratamento</h4>

                  <ul class="plano-list">

                     <% if (paciente.paciente_tipo_tratamento) { %>
                        <li>
                           <span class="list-icon">‚öïÔ∏è</span>
                           <%= paciente.paciente_tipo_tratamento %>
                              <% if (paciente.paciente_tempo_tratamento) { %>
                                 ( <%= paciente.paciente_tempo_tratamento %> )
                                    <% } %>
                        </li>
                        <% } %>

                           <% if (paciente.paciente_medicamentos_uso_essenciais) { %>
                              <li><span class="list-icon">üíä</span>
                                 <%= paciente.paciente_medicamentos_uso_essenciais %>
                              </li>
                              <% } %>

                                 <% if (paciente.paciente_data_ultima_sessao) { %>
                                    <li><span class="list-icon">üóìÔ∏è</span>
                                       √öltima Sess√£o:
                                       <%= paciente.paciente_data_ultima_sessao %>
                                    </li>
                                    <% } %>

                  </ul>

                  <button class="btn-secondary mt-3" onclick="abrirModalSaude()">Editar Sa√∫de</button>
               </div>
            </div>

            <!-- =========================== MODAL EDITAR SA√öDE =========================== -->
            <div id="modalSaude" class="modal-overlay" style="display: none;">
               <div class="modal-content">

                  <div class="modal-header">
                     <h2>Editar Perfil de Sa√∫de</h2>
                     <button class="close-btn" onclick="fecharModalSaude()">√ó</button>
                  </div>

                  <form id="formSaude">

                     <div class="modal-body">

                        <!-- Diagn√≥stico -->
                        <div class="campo-modal">
                           <label>Diagn√≥stico Principal</label>
                           <textarea name="paciente_diagnostico"
                              rows="2"><%= paciente.paciente_diagnostico || '' %></textarea>
                        </div>

                        <!-- Fase -->
                        <div class="campo-modal">
                           <label>Fase do Tratamento</label>
                           <input type="text" name="paciente_fase_tratamento"
                              value="<%= paciente.paciente_fase_tratamento || '' %>">
                        </div>

                        <!-- Tipo tratamento -->
                        <div class="campo-modal">
                           <label>Tipo de Tratamento</label>
                           <input type="text" name="paciente_tipo_tratamento"
                              value="<%= paciente.paciente_tipo_tratamento || '' %>">
                        </div>

                        <!-- Tempo tratamento -->
                        <div class="campo-modal">
                           <label>Dura√ß√£o / Tempo de Tratamento</label>
                           <input type="text" name="paciente_tempo_tratamento"
                              value="<%= paciente.paciente_tempo_tratamento || '' %>">
                        </div>

                        <!-- √öltima sess√£o -->
                        <div class="campo-modal">
                           <label>Data da √öltima Sess√£o</label>
                           <input type="date" name="paciente_data_ultima_sessao"
                              value="<%= paciente.paciente_data_ultima_sessao ? paciente.paciente_data_ultima_sessao.split('T')[0] : '' %>">
                        </div>

                        <!-- Alergias -->
                        <div class="campo-modal">
                           <label>Alergias</label>
                           <textarea name="paciente_alergias_risco"
                              rows="2"><%= paciente.paciente_alergias_risco || '' %></textarea>
                        </div>

                        <!-- Medicamentos essenciais -->
                        <div class="campo-modal">
                           <label>Medicamentos Essenciais</label>
                           <textarea name="paciente_medicamentos_uso_essenciais"
                              rows="2"><%= paciente.paciente_medicamentos_uso_essenciais || '' %></textarea>
                        </div>

                        <!-- Vulnerabilidade -->
                        <div class="campo-modal">
                           <label>Imunossupress√£o</label>
                           <select name="paciente_vulnerabilidade_imunossupressao">
                              <option value="0" <%=paciente.paciente_vulnerabilidade_imunossupressao==0 ? "selected"
                                 : "" %>>N√£o</option>
                              <option value="1" <%=paciente.paciente_vulnerabilidade_imunossupressao==1 ? "selected"
                                 : "" %>>Sim</option>
                           </select>
                        </div>

                        <!-- Restri√ß√µes alimentares -->
                        <div class="campo-modal">
                           <label>Restri√ß√µes Alimentares</label>
                           <textarea name="paciente_restricoes_alimentares"
                              rows="2"><%= paciente.paciente_restricoes_alimentares || '' %></textarea>
                        </div>

                        <!-- Restri√ß√µes de mobilidade -->
                        <div class="campo-modal">
                           <label>Restri√ß√µes de Mobilidade</label>
                           <textarea name="paciente_restricoes_mobilidade"
                              rows="2"><%= paciente.paciente_restricoes_mobilidade || '' %></textarea>
                        </div>

                        <!-- Prefer√™ncia hor√°rio de refei√ß√£o -->
                        <div class="campo-modal">
                           <label>Prefer√™ncia de Hor√°rio de Refei√ß√£o</label>
                           <select name="paciente_preferencia_horario_refeicao">
                              <option <%=paciente.paciente_preferencia_horario_refeicao==="Manh√£" ? "selected" : "" %>>
                                 Manh√£
                              </option>
                              <option <%=paciente.paciente_preferencia_horario_refeicao==="Tarde" ? "selected" : "" %>
                                 >Tarde</option>
                              <option <%=paciente.paciente_preferencia_horario_refeicao==="Noite" ? "selected" : "" %>
                                 >Noite</option>
                              <option <%=paciente.paciente_preferencia_horario_refeicao==="Indiferente" ? "selected"
                                 : "" %>>Indiferente</option>
                           </select>
                        </div>

                        <!-- Observa√ß√µes enfermagem -->
                        <div class="campo-modal">
                           <label>Observa√ß√µes da Enfermagem</label>
                           <textarea name="paciente_observacoes_enfermagem"
                              rows="3"><%= paciente.paciente_observacoes_enfermagem || '' %></textarea>
                        </div>

                        <!-- Observa√ß√µes gerais -->
                        <div class="campo-modal">
                           <label>Observa√ß√µes Gerais</label>
                           <textarea name="paciente_observacoes_gerais"
                              rows="3"><%= paciente.paciente_observacoes_gerais || '' %></textarea>
                        </div>

                     </div>

                     <div class="modal-footer">
                        <button type="button" class="btn-cancelar" onclick="fecharModalSaude()">Cancelar</button>
                        <button type="submit" class="btn-salvar">Salvar</button>
                     </div>

                  </form>
               </div>
            </div>

            <script>
               function abrirModalSaude() {
                  document.getElementById("modalSaude").style.display = "flex";
               }

               function fecharModalSaude() {
                  document.getElementById("modalSaude").style.display = "none";
               }

               document.getElementById("formSaude").addEventListener("submit", async function (e) {
                  e.preventDefault();

                  const formData = new FormData(this);
                  const dados = Object.fromEntries(formData.entries());

                  const resposta = await fetch("/paciente/atualizar", {
                     method: "POST",
                     headers: { "Content-Type": "application/json" },
                     body: JSON.stringify(dados)
                  });

                  const json = await resposta.json();

                  if (json.ok) {
                     alert("Informa√ß√µes atualizadas!");
                     location.reload();
                  } else {
                     alert("Erro ao atualizar!");
                  }
               });
            </script>
         </section>

         <!-- ======================================================================================================================-->
         <!--=============================================== SECTION HIST√ìRICO =====================================================-->
         <!--====================================================================================================================== -->
         <section id="historico" class="conteudo">
            <h2 class="section-title">Hist√≥rico Completo</h2>
            <p class="subtitle">Acompanhe todos os seus registros passados de servi√ßos e intera√ß√µes.</p>

            <div class="card card-historico">
               <div class="historico-filtros">
                  <label for="filtro-tipo">Filtrar por Tipo:</label>
                  <select id="filtro-tipo">
                     <option>Todos</option>
                     <option>Consultas</option>
                     <option>Hospedagens</option>
                     <option>Exames</option>
                  </select>
                  <button class="btn-secondary" type="button">Buscar</button>
                  <button class="btn-download" type="button">Exportar PDF</button>
               </div>

               <ul class="lista-historico">
                  <li class="historico-item">
                     <span class="historico-data">01/12/2024</span>
                     <span class="historico-desc">Consulta de rotina com Dra. Ana</span>
                     <span class="historico-tag badge badge-info">Consulta</span>
                     <button class="btn-sm btn-secondary">Ver Resumo</button>
                  </li>
                  <li class="historico-item">
                     <span class="historico-data">10/11/2024</span>
                     <span class="historico-desc">Check-out de Hospedagem (5 dias)</span>
                     <span class="historico-tag badge badge-service">Hospedagem</span>
                     <button class="btn-sm btn-secondary">Detalhes Acomoda√ß√£o</button>
                  </li>
               </ul>
            </div>
         </section>

         <!-- ======================================================================================================================-->
         <!--============================================== SECTION DOCUMENTOS =====================================================-->
         <!--====================================================================================================================== -->
         <section id="documentos" class="conteudo">
            <h2 class="section-title">Documentos e Resultados</h2>
            <p class="subtitle">Gerencie seus arquivos m√©dicos, exames e laudos.</p>

            <div class="card card-documentos">
               <h3 class="card-title">Meus Arquivos</h3>
               <div class="lista-arquivos">
                  <div class="arquivo-item">
                     <span class="file-icon">üìÑ</span>
                     <span class="file-name">Resultado Bi√≥psia_15_12_2024.pdf</span>
                     <span class="file-size">2.3 MB</span>
                     <button class="btn-sm btn-secondary">Baixar</button>
                     <button class="btn-sm btn-danger">Excluir</button>
                  </div>
                  <div class="arquivo-item">
                     <span class="file-icon">üñºÔ∏è</span>
                     <span class="file-name">Raio X T√≥rax_05_01_2025.jpg</span>
                     <span class="file-size">1.1 MB</span>
                     <button class="btn-sm btn-secondary">Baixar</button>
                     <button class="btn-sm btn-danger">Excluir</button>
                  </div>
               </div>

               <h3 class="card-title mt-4">Enviar Novo Documento</h3>
               <div class="upload-area">
                  <label for="upload" class="upload-label">
                     Clique para selecionar ou arraste arquivos aqui. (M√°x: 10MB)
                  </label>
                  <input type="file" id="upload" multiple style="display: none;">
                  <button class="btn-primary" type="button">Enviar Arquivos</button>
               </div>
            </div>
         </section>

         <!-- ======================================================================================================================-->
         <!--============================================== SECTION ALIMENTA√á√ÉO ====================================================-->
         <!--====================================================================================================================== -->
         <section id="alimentacao" class="conteudo">
            <h2 class="section-title">Alimenta√ß√£o e Refei√ß√µes</h2>
            <p class="subtitle">Confira o card√°pio e personalize sua dieta.</p>

            <div class="card card-alimentacao">
               <h3 class="card-title">Card√°pio do Dia - <%= new Date().toLocaleDateString('pt-BR', { weekday: 'long' ,
                     day: 'numeric' , month: 'long' }) %>
               </h3>
               <div class="cardapio-grid">
                  <div class="refeicao-item">
                     <h4>Caf√© da Manh√£ (8:00)</h4>
                     <p>P√£o integral, Queijo branco, Suco de laranja natural.</p>
                  </div>
                  <div class="refeicao-item">
                     <h4>Almo√ßo (12:00)</h4>
                     <p>Arroz, Feij√£o, Frango grelhado, Pur√™ de batata, Salada mista.</p>
                  </div>
                  <div class="refeicao-item">
                     <h4>Jantar (19:00)</h4>
                     <p>Sopa de legumes, Torradas integrais.</p>
                  </div>
               </div>

               <h3 class="card-title mt-4">Minha Dieta Especial</h3>
               <p><strong>Restri√ß√µes:</strong> Sem gl√∫ten, Sem lactose.</p>
               <p>Seus pedidos especiais est√£o sendo atendidos. Caso precise de altera√ß√£o, solicite abaixo.</p>
               <button class="btn-primary mt-3">Solicitar Altera√ß√£o de Dieta</button>
            </div>
         </section>

         <!-- ======================================================================================================================-->
         <!--===================================================== SECTION AVALIA√á√ÉO ================================================-->
         <!--====================================================================================================================== -->
         <section id="avaliacao" class="conteudo">
            <h2 class="section-title">Avalia√ß√£o do Alojamento</h2>

            <p class="subtitle">
               Sua opini√£o √© essencial para melhorarmos continuamente o acolhimento do Instituto Vita.
            </p>

            <% if (typeof msgSucesso !=="undefined" && msgSucesso) { %>
               <div class="alert alert-success" style="
                  background: #cfe9d1;
                  color: #23543b;
                  padding: 15px;
                  border-radius: 8px;
                  margin-bottom: 20px;
                  border-left: 6px solid #3a7d55;
                  font-weight: 600;
               ">
                  <%= msgSucesso %>
               </div>
               <% } %>

                  <div class="card card-avaliacao">
                     <form id="formAvaliacao" action="/paciente/avaliacoes" method="POST">
                        <div class="campo">
                           <label>Como voc√™ avalia sua estadia?</label>
                           <select name="avaliacao_nota" required>
                              <option value="">Selecione...</option>
                              <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ‚Äî Excelente</option>
                              <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê ‚Äî Muito Boa</option>
                              <option value="3">‚≠ê‚≠ê‚≠ê ‚Äî Boa</option>
                              <option value="2">‚≠ê‚≠ê ‚Äî Regular</option>
                              <option value="1">‚≠ê ‚Äî Ruim</option>
                           </select>
                        </div>

                        <div class="campo">
                           <label>Coment√°rios (opcional):</label>
                           <textarea name="avaliacao_comentario" rows="4"
                              placeholder="Conte-nos sobre sua experi√™ncia..."></textarea>
                        </div>

                        <button class="btn-success" type="submit">Enviar Avalia√ß√£o</button>
                     </form>
                  </div>
         </section>

      </main>
   </div>

   <footer>
      <div class="footer-container">
         <div class="footer-about">
            <h3>Sobre a Empresa</h3>
            <p>Somos uma organiza√ß√£o dedicada a oferecer hospedagem com amor, cuidado e dignidade para pacientes e
               familiares.</p>
         </div>
         <div class="footer-contact">
            <h3>Contato</h3>
            <p>Email: contato@empresa.com.br</p>
            <p>Telefone: (11) 1234-5678</p>
            <p>Endere√ßo: Rua Exemplo, 123 - S√£o Paulo, SP</p>
         </div>
         <div class="footer-links">
            <h3>Links √öteis</h3>
            <a href="#">Pol√≠tica de Privacidade</a><br>
            <a href="#">Termos de Uso</a><br>
            <a href="#">Ajuda</a>
         </div>
      </div>
      <div class="footer-bottom">
         <p>¬© 2024 Empresa. Todos os direitos reservados.</p>
      </div>
   </footer>

   <script>
      const sidebarItems = document.querySelectorAll('.sidebar-item');
      const contents = document.querySelectorAll('.conteudo');

      // Fun√ß√£o gen√©rica para ativar se√ß√£o
      function ativarSection(id) {
         // Esconde tudo
         contents.forEach(sec => sec.classList.remove('ativo'));
         sidebarItems.forEach(i => i.classList.remove('active'));

         // Ativa os corretos
         const sec = document.getElementById(id);
         const item = document.querySelector(`.sidebar-item[data-target="${id}"]`);

         if (sec && item) {
            sec.classList.add('ativo');
            item.classList.add('active');
         }
      }

      // Fun√ß√£o para trocar a aba (wrapper da fun√ß√£o ativarSection)
      function abrirAba(idAlvo) {
         ativarSection(idAlvo);
      }

      // ‚¨Ö Salvar √∫ltima aba no localStorage
      document.querySelectorAll('.sidebar-item').forEach(item => {
         item.addEventListener('click', () => {
            const alvo = item.getAttribute('data-target');
            localStorage.setItem('ultimaSectionPaciente', alvo);
            abrirAba(alvo);
         });
      });

      // Checar par√¢metro da URL (aba=)
      const params = new URLSearchParams(window.location.search);
      const abaURL = params.get('aba');

      window.addEventListener('DOMContentLoaded', () => {
         const ultima = localStorage.getItem('ultimaSectionPaciente');

         if (abaURL) {
            // Prioridade 1: URL
            abrirAba(abaURL);
         } else if (ultima) {
            // Prioridade 2: √∫ltima aba salva
            ativarSection(ultima);
         } else {
            // Prioridade 3: primeira aba ou a que j√° estiver active no HTML
            const ativa = document.querySelector('.sidebar-item.active');

            if (ativa) {
               ativarSection(ativa.dataset.target);
            } else if (sidebarItems.length > 0) {
               ativarSection(sidebarItems[0].dataset.target);
            }
         }
      });
   </script>

</body>

</html>