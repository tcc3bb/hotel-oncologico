<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Reserva | Instituto Vita</title>
    <link rel="icon" href="/image/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=EB+Garamond&family=Uncial+Antiqua&family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/reservas/style_nova_reserva.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- ================================================= MENU ================================================= -->
    <nav>
        <a href="/" class="img">
            <img src="/image/logo.png" alt="Logo da Empresa" class="img-logo">
        </a>
        <a href="/nav/sobre-nos">Sobre nós</a>
        <a href="/nav/sobre-cancer">Sobre o câncer</a>
        <a href="/nav/acomodacoes">Acomodações</a>
        <a href="/nav/apoio-paciente">Apoio ao paciente</a>
        <a href="/nav/localizacao">Localizações</a>
        <a href="/perguntas/perguntas-frequentes">Perguntas frequentes</a>
        <% if (!user) { %>
            <a href="/usuarios/login" class="btn-entrar">Entrar</a>
            <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
            <% } else { %>
                <% if (user.tipo==='paciente' ) { %>
                    <a href="/paciente/minhas-reservas" class="btn-nav">Minhas Reservas</a>
                    <% } else if (user.tipo==='acompanhante' ) { %>
                        <a href="/acompanhante/apoio-ao-paciente" class="btn-nav">Apoio ao Paciente</a>
                        <% } else if (user.tipo==='voluntario' ) { %>
                            <a href="/voluntario/area-do-voluntario" class="btn-nav">Área do Voluntários</a>
                            <% } else if (user.tipo==='doador' ) { %>
                                <a href="/doador/minhas-doacoes" class="btn-nav">Minhas Doações</a>
                                <% } else if (user.tipo==='admin' ) { %>
                                    <a href="/admin/painel" class="btn-nav">Configurações</a>
                                    <% } else { %>
                                        <a href="/usuarios/login" class="btn-entrar">Entrar</a>
                                        <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
                                        <% } %>
                                            <a href="/usuarios/logout" class="btn-logout">Sair</a>
                                            <% } %>
    </nav>

    <!-- ============================================= CONTEÚDO PRINCIPAL ============================================= -->
    <main class="reserva-container">
        <!-- Cabeçalho da página -->
        <div class="page-header text-center mb-5">
            <h3 class="title-header" style="color: var(--verde-escuro);">
                <i class="fas fa-calendar-check me-3"></i>Nova Reserva
            </h3>
            <p class="lead text-muted mx-auto" style="max-width: 800px;">
                Selecione o quarto que melhor atende às suas necessidades e preencha os dados para sua estadia.
                Estamos aqui para oferecer o máximo de conforto durante este período.
            </p>
        </div>

        <% if (flashMessage && flashMessage.length> 0) { %>
            <div class="alert alert-danger alert-custom" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <%= flashMessage %>
            </div>
            <% } %>

                <div class="container reserva-wrapper">
                    <div class="row g-5">
                        <!-- ====================== SELEÇÃO DE QUARTOS ====================== -->
                        <div class="col-lg-7">
                            <div class="card quartos-card shadow-lg border-0">
                                <div class="card-header bg-verde-escuro text-white py-3">
                                    <h3 class="mb-0"><i class="fas fa-bed me-2"></i>Tipos de Quartos Disponíveis</h3>
                                </div>
                                <div class="card-body p-4">
                                    <% if (tipos && tipos.length> 0) { %>
                                        <div class="row g-4">
                                            <% tipos.forEach(tipo=> { %>
                                                <div class="col-md-6">
                                                    <div class="tipo-quarto-card"
                                                        data-tipo-id="<%= tipo.tipo_quarto_id %>">
                                                        <div class="quarto-img-container">
                                                            <% if (tipo.fotos.length> 0) { %>
                                                                <img class="quarto-main-img"
                                                                    id="main-img-<%= tipo.tipo_quarto_id %>"
                                                                    src="<%= tipo.fotos[0].foto_caminho %>"
                                                                    alt="<%= tipo.tipo_quarto_nome %>">
                                                                <% if (tipo.fotos.length> 1) { %>
                                                                    <div class="quarto-thumbnails">
                                                                        <% tipo.fotos.forEach((foto, index)=> { %>
                                                                            <img src="<%= foto.foto_caminho %>"
                                                                                data-target="main-img-<%= tipo.tipo_quarto_id %>"
                                                                                class="thumbnail-img <%= index === 0 ? 'active' : '' %>"
                                                                                alt="Miniatura <%= index + 1 %>">
                                                                            <% }) %>
                                                                    </div>
                                                                    <% } %>
                                                                        <% } else { %>
                                                                            <img class="quarto-main-img"
                                                                                src="/img/quartos/sem-imagem.jpg"
                                                                                alt="Sem imagem disponível">
                                                                            <% } %>
                                                                                <div class="quarto-selecionado-badge">
                                                                                    <i class="fas fa-check-circle"></i>
                                                                                    Selecionado
                                                                                </div>
                                                        </div>

                                                        <div class="quarto-info p-3">
                                                            <h4 class="quarto-nome mb-2">
                                                                <%= tipo.tipo_quarto_nome %>
                                                            </h4>
                                                            <p class="quarto-descricao text-muted mb-3">
                                                                <%= tipo.tipo_quarto_descricao %>
                                                            </p>

                                                            <div class="quarto-amenidades mb-3">
                                                                <span class="amenidade-badge">
                                                                    <i class="fas fa-wifi"></i> Wi-Fi
                                                                </span>
                                                                <span class="amenidade-badge">
                                                                    <i class="fas fa-tv"></i> TV
                                                                </span>
                                                                <span class="amenidade-badge">
                                                                    <i class="fas fa-bath"></i> Banheiro
                                                                </span>
                                                            </div>

                                                            <div class="form-check selecao-quarto">
                                                                <input class="form-check-input" type="radio"
                                                                    name="tipo_quarto_id"
                                                                    id="quarto-<%= tipo.tipo_quarto_id %>"
                                                                    value="<%= tipo.tipo_quarto_id %>" required>
                                                                <label class="form-check-label"
                                                                    for="quarto-<%= tipo.tipo_quarto_id %>">
                                                                    Selecionar este quarto
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <% }) %>
                                        </div>
                                        <% } else { %>
                                            <div class="text-center py-5">
                                                <i class="fas fa-bed fa-3x text-muted mb-3"></i>
                                                <h5 class="text-muted">Nenhum tipo de quarto disponível no momento.</h5>
                                                <p class="text-muted">Entre em contato com nossa equipe para mais
                                                    informações.</p>
                                            </div>
                                            <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- ====================== FORMULÁRIO DE RESERVA ====================== -->
                        <div class="col-lg-5">
                            <form action="/reservas/nova" method="POST"
                                class="card formulario-reserva shadow-lg border-0">
                                <div class="card-header bg-verde-medio text-white py-3">
                                    <h3 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Detalhes da Reserva</h3>
                                </div>

                                <div class="card-body p-4">
                                    <!-- Informações da Reserva -->
                                    <div class="info-reserva-box p-3 mb-4">
                                        <h5 class="d-flex align-items-center">
                                            <i class="fas fa-info-circle me-2 text-verde-escuro"></i>
                                            Informações importantes
                                        </h5>
                                        <ul class="mb-0 ps-3 text-muted">
                                            <li>Check-in a partir das 14:00</li>
                                            <li>Check-out até às 12:00</li>
                                        </ul>
                                    </div>

                                    <!-- Datas da Reserva -->
                                    <div class="mb-4">
                                        <label class="form-label fw-semibold mb-2">
                                            <i class="fas fa-calendar-alt me-2"></i>Período da estadia
                                        </label>
                                        <div class="input-group datepicker-group">
                                            <span class="input-group-text bg-verde-claro">
                                                <i class="fas fa-calendar text-verde-escuro"></i>
                                            </span>
                                            <input type="text" id="dateRange" class="form-control datepicker-input"
                                                placeholder="Escolha as datas da sua estadia" required readonly>
                                        </div>
                                        <div class="form-text text-muted mt-1">
                                            Selecione a data de entrada e saída
                                        </div>

                                        <input type="hidden" name="reserva_data_checkin_previsto" id="checkin">
                                        <input type="hidden" name="reserva_data_checkout_previsto" id="checkout">
                                    </div>

                                    <!-- Acompanhante -->
                                    <div class="mb-4">
                                        <label class="form-label fw-semibold mb-2">
                                            <i class="fas fa-user-plus me-2"></i>Acompanhante
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-verde-claro">
                                                <i class="fas fa-envelope text-verde-escuro"></i>
                                            </span>
                                            <input type="email" class="form-control" name="acompanhante_email"
                                                placeholder="E-mail do acompanhante (opcional)">
                                        </div>
                                        <div class="form-text text-muted mt-1">
                                            Caso deseje incluir um acompanhante na reserva
                                        </div>
                                    </div>

                                    <!-- Resumo da Reserva -->
                                    <div class="resumo-reserva p-3 mb-4">
                                        <h5 class="mb-3">Resumo da Reserva</h5>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Quarto selecionado:</span>
                                            <span class="fw-semibold" id="quarto-selecionado-text">Nenhum</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Período:</span>
                                            <span class="fw-semibold" id="periodo-text">Não definido</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Acompanhante:</span>
                                            <span class="fw-semibold" id="acompanhante-text">Não informado</span>
                                        </div>
                                    </div>

                                    <!-- Botão de Confirmação -->
                                    <button type="submit" class="btn btn-confirmar w-100 py-3 fs-5">
                                        <i class="fas fa-lock me-2"></i>Confirmar Reserva
                                    </button>

                                    <div class="text-center mt-3">
                                        <small class="text-muted">
                                            <i class="fas fa-shield-alt me-1"></i>
                                            Sua reserva está protegida e seus dados são confidenciais
                                        </small>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
    </main>

    <!-- ================================================= FOOTER ================================================= -->
    <footer>
        <div class="footer-container">
            <div class="footer-about">
                <h3>Sobre o Instituto Vita</h3>
                <p>Oferecemos hospedagem acolhedora e humanizada para pacientes oncológicos e seus familiares, com
                    conforto, cuidado e dignidade.</p>
            </div>
            <div class="footer-contact">
                <h3>Contato</h3>
                <p><i class="fas fa-envelope me-2"></i>contato@institutovita.com.br</p>
                <p><i class="fas fa-phone me-2"></i>(11) 1234-5678</p>
                <p><i class="fas fa-map-marker-alt me-2"></i>Rua Exemplo, 123 - São Paulo, SP</p>
            </div>
            <div class="footer-links">
                <h3>Links Úteis</h3>
                <a href="#"><i class="fas fa-file-contract me-1"></i>Política de Privacidade</a><br>
                <a href="#"><i class="fas fa-scale-balanced me-1"></i>Termos de Uso</a><br>
                <a href="#"><i class="fas fa-question-circle me-1"></i>Ajuda</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2024 Instituto Vita. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- ================================================= SCRIPTS ================================================= -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Flatpickr para seleção de datas
            const dateRangePicker = flatpickr("#dateRange", {
                mode: "range",
                dateFormat: "d/m/Y",
                locale: "pt",
                minDate: "today",
                disableMobile: "true",
                onChange: function (selectedDates) {
                    if (selectedDates.length === 2) {
                        const checkin = selectedDates[0];
                        const checkout = selectedDates[1];

                        // Formata para exibição
                        const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                        const periodoText = `${checkin.toLocaleDateString('pt-BR')} até ${checkout.toLocaleDateString('pt-BR')}`;
                        document.getElementById("periodo-text").textContent = periodoText;

                        // Calcula número de noites
                        const diffTime = Math.abs(checkout - checkin);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                        // Atualiza total estimado
                        const valorDiaria = 350; // Valor exemplo - pode ser dinâmico
                        const total = valorDiaria * diffDays;
                        document.getElementById("total-estimado").textContent =
                            `R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

                        // Define valores dos campos hidden
                        document.getElementById("checkin").value = checkin.toISOString().slice(0, 19).replace('T', ' ');
                        document.getElementById("checkout").value = checkout.toISOString().slice(0, 19).replace('T', ' ');
                    }
                }
            });

            // Seleção de quartos
            document.querySelectorAll('input[name="tipo_quarto_id"]').forEach(radio => {
                radio.addEventListener('change', function () {
                    // Remove seleção anterior
                    document.querySelectorAll('.tipo-quarto-card').forEach(card => {
                        card.classList.remove('selected');
                    });

                    // Adiciona seleção ao card atual
                    const card = this.closest('.tipo-quarto-card');
                    if (card) {
                        card.classList.add('selected');

                        // Atualiza resumo
                        const nomeQuarto = card.querySelector('.quarto-nome').textContent;
                        document.getElementById("quarto-selecionado-text").textContent = nomeQuarto;
                    }
                });
            });

            // Troca de imagens nas miniaturas
            document.querySelectorAll('.thumbnail-img').forEach(img => {
                img.addEventListener('click', function () {
                    const targetId = this.getAttribute('data-target');
                    const mainImg = document.getElementById(targetId);

                    if (mainImg) {
                        // Atualiza imagem principal
                        mainImg.src = this.src;

                        // Atualiza estado ativo das miniaturas
                        this.closest('.quarto-thumbnails').querySelectorAll('.thumbnail-img').forEach(i => {
                            i.classList.remove('active');
                        });
                        this.classList.add('active');
                    }
                });
            });

            // Atualiza acompanhante em tempo real
            document.querySelector('input[name="acompanhante_email"]').addEventListener('input', function (e) {
                const email = e.target.value.trim();
                const acompanhanteText = document.getElementById("acompanhante-text");

                if (email) {
                    acompanhanteText.textContent = email;
                } else {
                    acompanhanteText.textContent = "Não informado";
                }
            });

            // Validação do formulário antes de enviar
            document.querySelector('form').addEventListener('submit', function (e) {
                const quartoSelecionado = document.querySelector('input[name="tipo_quarto_id"]:checked');
                const dates = dateRangePicker.selectedDates;

                if (!quartoSelecionado) {
                    e.preventDefault();
                    alert('Por favor, selecione um tipo de quarto.');
                    return;
                }

                if (!dates || dates.length !== 2) {
                    e.preventDefault();
                    alert('Por favor, selecione o período da estadia.');
                    return;
                }
            });
        });
    </script>
</body>

</html>