<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localiza√ß√µes - Instituto Vita</title>
    <link rel="icon" href="/image/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=EB+Garamond&family=Uncial+Antiqua&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/nav/style_localizacao.css">
    <script src="https://kit.fontawesome.com/7df7a5cfa1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>
    <nav>
        <div class="nav-links">
            <a href="/" class="img">
                <img src="/image/logo.png" alt="Logo da Empresa" class="img-logo">
            </a>
            <a href="/nav/sobre-nos">Sobre n√≥s</a>
            <a href="/nav/sobre-cancer">Sobre o c√¢ncer</a>
            <a href="/nav/acomodacoes">Acomoda√ß√µes</a>
            <a href="/nav/apoio-paciente">Apoio ao paciente</a>
            <a href="/nav/localizacao">Localiza√ß√µes</a>
            <a href="/perguntas/perguntas-frequentes">Perguntas frequentes</a>
            <% if (!user) { %>
                <!-- Usu√°rio n√£o logado -->
                <a href="/usuarios/login" class="btn-entrar">Entrar</a>
                <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
                <% } else { %>
                    <!-- Usu√°rio logado -->
                    <% if (user.tipo==='paciente' ) { %>
                        <a href="/paciente/minhas-reservas" class="btn-nav">Minhas Reservas</a>
                        <% } else if (user.tipo==='acompanhante' ) { %>
                            <a href="/acompanhante/apoio-ao-paciente" class="btn-nav">Apoio ao Paciente</a>
                            <% } else if (user.tipo==='voluntario' ) { %>
                                <a href="/voluntario/area-do-voluntario" class="btn-nav">√Årea do Volunt√°rios</a>
                                <% } else if (user.tipo==='doador' ) { %>
                                    <a href="/doador/minhas-doacoes" class="btn-nav">Minhas Doa√ß√µes</a>
                                    <% } else if (user.tipo==='admin' ) { %>
                                        <a href="/admin/painel" class="btn-nav">Configura√ß√µes</a>
                                        <% } else { %>
                                            <!-- Caso algum outro tipo apare√ßa -->
                                            <a href="/usuarios/login" class="btn-entrar">Entrar</a>
                                            <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
                                            <% } %>
                                                <!-- Bot√£o de logout -->
                                                <a href="/usuarios/logout" class="btn-logout">Sair</a>
                                                <% } %>
        </div>
    </nav>

    <main>
        <!-- NOSSO HOTEL COM ENDERE√áO REAL -->
        <div class="localizacao-card" data-lat="-23.5620" data-lng="-46.6550"
            data-nome="Instituto Vita - Casa de Apoio Oncol√≥gico"
            data-endereco="Av. Dr. En√©as Carvalho de Aguiar, 255 - Cerqueira C√©sar, S√£o Paulo - SP">
            <div class="mini-mapa">
                <img src="/image/localizacao/fachada.jpg" alt="Instituto Vita - Casa de Apoio Oncol√≥gico">
            </div>

            <div class="localizacao-info">
                <h2>üìç Nossa Localiza√ß√£o</h2>
                <h3>Instituto Vita - Casa de Apoio Oncol√≥gico</h3>
                <p>Av. Dr. En√©as Carvalho de Aguiar, 255 - Cerqueira C√©sar, S√£o Paulo - SP, 05403-000</p>
                <p class="descricao">Nossa casa de apoio est√° estrategicamente localizada pr√≥xima aos principais centros
                    de tratamento oncol√≥gico de S√£o Paulo, oferecendo conforto, seguran√ßa e proximidade para pacientes e
                    familiares durante o tratamento.</p>
                <p class="descricao"><strong>Hor√°rio de funcionamento:</strong> 24 horas, 7 dias por semana</p>
                <p class="descricao"><strong>Telefone:</strong> (11) 3061-7000</p>
            </div>

            <!-- BOT√ÉO MAPA NO CANTO SUPERIOR DIREITO -->
            <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
        </div>

        <!-- HOSPITAIS -->
        <section class="hospitais-section">
            <div class="section-header">
                <h2> Hospitais Pr√≥ximos</h2>
                <p class="descricao">
                    Esses s√£o os hospitais mais pr√≥ximos da nossa casa de apoio, oferecendo atendimento
                    comum e especializado no tratamento do c√¢ncer.
                </p>
            </div>

            <div class="cards-container hospitais-cards">
                <div class="card"
                    data-info="Hospital do C√¢ncer de S√£o Paulo √© refer√™ncia nacional no tratamento oncol√≥gico, oferecendo atendimento multidisciplinar e tecnologia de ponta."
                    data-lat="-23.5565" data-lng="-46.6601">
                    <span class="category-badge">Hospital Oncol√≥gico</span>
                    <img src="/image/localizacao/hospital_do_cancer.jpg" alt="Hospital do C√¢ncer de S√£o Paulo">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="card-content">
                        <h3>Hospital do C√¢ncer de S√£o Paulo</h3>
                        <p>R. Dr. Arnaldo, 251, Cerqueira Cezar, S√£o Paulo, SP</p>
                        <p class="descricao">Refer√™ncia nacional em oncologia com atendimento 24 horas e equipe
                            especializada.</p>
                    </div>
                </div>

                <div class="card"
                    data-info="Santa Casa √© uma institui√ß√£o filantr√≥pica com atendimento gratuito e especializado em diversas √°reas da sa√∫de."
                    data-lat="-23.5500" data-lng="-46.6550">
                    <span class="category-badge">Hospital Geral</span>
                    <img src="/image/localizacao/santa_casa.png" alt="Santa Casa de Miseric√≥rdia de S√£o Paulo">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="card-content">
                        <h3>Santa Casa de Miseric√≥rdia de S√£o Paulo</h3>
                        <p>Av. Santa de Carvalho Aguiar, 255, Cerqueira C√©sar, S√£o Paulo, SP</p>
                        <p class="descricao">Institui√ß√£o filantr√≥pica com mais de 400 anos de hist√≥ria no atendimento √†
                            sa√∫de.</p>
                    </div>
                </div>

                <div class="card"
                    data-info="Hospital Oswaldo Cruz √© refer√™ncia em oncologia privada com equipe multidisciplinar e tecnologia avan√ßada."
                    data-lat="-23.5620" data-lng="-46.6570">
                    <span class="category-badge">Hospital Privado</span>
                    <img src="/image/localizacao/hospital_oswaldo_cruz.jpg" alt="Hospital Alem√£o Oswaldo Cruz">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="card-content">
                        <h3>Hospital Alem√£o Oswaldo Cruz</h3>
                        <p>Rua das Tr√™s Irm√£s, 100, Para√≠so, S√£o Paulo, SP</p>
                        <p class="descricao">Excel√™ncia em oncologia com estrutura moderna e equipe especializada.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FARM√ÅCIAS - AGORA EM GRID CENTRALIZADO -->
        <section class="farmacias-section">
            <div class="section-header">
                <h2>Farm√°cias Pr√≥ximas</h2>
                <p class="descricao">Essas s√£o as farm√°cias mais pr√≥ximas da nossa casa de apoio, oferecendo
                    medicamentos, produtos de sa√∫de e atendimento especializado.</p>
            </div>

            <div class="cards-container">
                <div class="farmacia-card"
                    data-info="Drogasil possui ampla variedade de medicamentos, produtos de beleza e cuidados pessoais com atendimento qualificado."
                    data-lat="-23.5580" data-lng="-46.6590">
                    <span class="category-badge">Farm√°cia Popular</span>
                    <img src="/image/localizacao/drogasil.jpg" alt="Drogasil">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="farmacia-card-content">
                        <h3>Drogasil</h3>
                        <p>R. Br. de Itapetininga, 40 - Centro, S√£o Paulo, SP</p>
                        <p class="descricao">Aberta 24 horas ‚Ä¢ Entrega em domic√≠lio ‚Ä¢ Programa de descontos</p>
                    </div>
                </div>

                <div class="farmacia-card"
                    data-info="Ambulat√≥rio especializado em medicamentos de alto custo com atendimento humanizado."
                    data-lat="-23.5575" data-lng="-46.6585">
                    <span class="category-badge">Medicamentos Especiais</span>
                    <img src="/image/localizacao/ambulatorio.webp" alt="Ambulat√≥rio Dr. Geraldo Bourroul">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="farmacia-card-content">
                        <h3>Ambulat√≥rio Dr. Geraldo Bourroul</h3>
                        <p>Rua Martins Fontes, 208, S√£o Paulo, SP</p>
                        <p class="descricao">Especializada em medicamentos de alto custo ‚Ä¢ Atendimento personalizado</p>
                    </div>
                </div>

                <div class="farmacia-card"
                    data-info="Ame Marsz Z√©lia oferece atendimento p√∫blico e gratuito com medicamentos b√°sicos e especializados."
                    data-lat="-23.5590" data-lng="-46.6575">
                    <span class="category-badge">Atendimento P√∫blico</span>
                    <img src="/image/localizacao/ame-maria_zelia.jpg" alt="Ame Marsz Z√©lia">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="farmacia-card-content">
                        <h3>Ame Maria Z√©lia</h3>
                        <p>R. Jequitinhonha, 368 - Belenzinho, S√£o Paulo</p>
                        <p class="descricao">Atendimento p√∫blico gratuito ‚Ä¢ Medicamentos do SUS ‚Ä¢ Hor√°rio comercial</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CL√çNICAS -->
        <section class="clinicas-section">
            <div class="section-header">
                <h2>Cl√≠nicas Pr√≥ximas</h2>
                <p class="descricao">Essas s√£o as cl√≠nicas mais pr√≥ximas da nossa casa de apoio, oferecendo consultas,
                    exames e tratamentos especializados.</p>
            </div>

            <div class="cards-container clinicas-cards">
                <div class="card"
                    data-info="Atendimento especializado em oncologia com equipe multidisciplinar e tecnologia avan√ßada."
                    data-lat="-23.5610" data-lng="-46.6555">
                    <span class="category-badge">Oncologia</span>
                    <img src="/image/localizacao/clinica_oncologica.jpg" alt="Cl√≠nica Oncol√≥gica S√£o Camilo">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="card-content">
                        <h3>Cl√≠nica Oncol√≥gica S√£o Camilo</h3>
                        <p>Av. Albert Einstein, 627, Morumbi, S√£o Paulo, SP</p>
                        <p class="descricao">Oncologia especializada ‚Ä¢ Quimioterapia ‚Ä¢ Acompanhamento multidisciplinar
                        </p>
                    </div>
                </div>

                <div class="card"
                    data-info="Consultas populares em diversas especialidades m√©dicas com pre√ßos acess√≠veis."
                    data-lat="-23.5630" data-lng="-46.6545">
                    <span class="category-badge">Cl√≠nica Geral</span>
                    <img src="/image/localizacao/clinica_da_cidade.png" alt="Cl√≠nica da Cidade">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="card-content">
                        <h3>Cl√≠nica da Cidade</h3>
                        <p>Av. Brigadeiro Lu√≠s Ant√¥nio, 483 - S√£o Paulo, SP</p>
                        <p class="descricao">Consultas acess√≠veis ‚Ä¢ V√°rias especialidades ‚Ä¢ Atendimento r√°pido</p>
                    </div>
                </div>

                <div class="card" data-info="Rede Dr. Consulta - consultas e exames r√°pidos com agilidade e qualidade."
                    data-lat="-23.5650" data-lng="-46.6535">
                    <span class="category-badge">Consultas R√°pidas</span>
                    <img src="/image/localizacao/dr_consulta.jpeg" alt="Dr. Consulta">
                    <button class="mapa-sobre-img"><i class="fas fa-map-marker-alt"></i> Mapa</button>
                    <div class="card-content">
                        <h3>Dr. Consulta</h3>
                        <p>R. Brg. Tobias, 600 - Centro, S√£o Paulo, SP</p>
                        <p class="descricao">Consultas r√°pidas ‚Ä¢ Exames no local ‚Ä¢ Atendimento por plano e particular
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- MODAL DO MAPA COM SCROLL -->
    <div class="modal" id="mapModal">
        <div class="modal-content">
            <span class="fechar" id="fecharMapa">&times;</span>

            <!-- Cabe√ßalho fixo -->
            <div class="modal-header">
                <h3 id="tituloMapa"></h3>
            </div>

            <!-- Corpo do modal com scroll -->
            <div class="modal-body">
                <!-- Mapa grande -->
                <div class="map-container">
                    <div id="map"></div>
                </div>

                <!-- Informa√ß√µes abaixo do mapa -->
                <div class="map-details">
                    <div class="map-info">
                        <p><strong>üìç Endere√ßo:</strong> <span id="mapEndereco"></span></p>
                        <p><strong>üìè Dist√¢ncia:</strong> <span id="mapDistancia"></span></p>
                    </div>

                    <!-- Informa√ß√µes adicionais -->
                    <div class="additional-info" id="additionalInfo">
                        <!-- As informa√ß√µes extras ser√£o inseridas aqui pelo JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-about">
                <h3>Sobre a Empresa</h3>
                <p>Somos uma organiza√ß√£o dedicada a oferecer hospedagem com amor, cuidado e dignidade para pacientes e
                    familiares.</p>
            </div>
            <div class="footer-contact">
                <h3>Contato</h3>
                <p>Email: contato@empresa.com.br</p>
                <p>Telefone: (11) 1234-5678</p>
                <p>Endere√ßo: Rua Exemplo, 123 - S√£o Paulo, SP</p>
            </div>
            <div class="footer-links">
                <h3>Links √öteis</h3>
                <a href="#">Pol√≠tica de Privacidade</a><br>
                <a href="#">Termos de Uso</a><br>
                <a href="#">Ajuda</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2024 Empresa. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        /*====== MENU MOBILE ======*/
        const hamburger = document.createElement("div");
        hamburger.classList.add("hamburger");
        hamburger.innerHTML = "<span></span><span></span><span></span>";

        document.querySelector("nav").prepend(hamburger);

        hamburger.addEventListener("click", () => {
            document.querySelector(".nav-links").classList.toggle("active");
        });

        // ==================== MODAL DO MAPA ====================
        const mapModal = document.getElementById('mapModal');
        const fecharMapa = document.getElementById('fecharMapa');
        const tituloMapa = document.getElementById('tituloMapa');
        const mapEndereco = document.getElementById('mapEndereco');
        const mapDistancia = document.getElementById('mapDistancia');
        let map = null;

        // Coordenadas do Instituto Vita
        const institutoVitaCoords = {
            lat: -23.5620,
            lng: -46.6550
        };

        // Fun√ß√£o para calcular dist√¢ncia (f√≥rmula Haversine)
        function calcularDistancia(lat1, lon1, lat2, lon2) {
            const R = 6371; // Raio da Terra em km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        // Fun√ß√£o para ajustar a altura do mapa
        function ajustarAlturaMapa() {
            const mapContainer = document.getElementById('map');
            if (!mapContainer) return;

            const alturaTela = window.innerHeight;
            const larguraTela = window.innerWidth;

            if (alturaTela < 700 || larguraTela < 768) {
                mapContainer.style.height = '250px';
                mapContainer.style.minHeight = '200px';
            } else if (alturaTela < 500) {
                mapContainer.style.height = '200px';
                mapContainer.style.minHeight = '150px';
            } else {
                mapContainer.style.height = '400px';
                mapContainer.style.minHeight = '300px';
            }

            // Redimensiona o mapa se j√° existir
            if (map) {
                setTimeout(() => {
                    map.invalidateSize();
                }, 100);
            }
        }

        // Adiciona event listener para todos os bot√µes "Mapa"
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.mapa-sobre-img').forEach(botao => {
                botao.addEventListener('click', async function (e) {
                    e.stopPropagation();
                    console.log('Bot√£o mapa clicado');

                    const card = this.closest('.card, .farmacia-card, .localizacao-card');
                    if (!card) {
                        console.error('Card n√£o encontrado');
                        return;
                    }

                    const nomeElement = card.querySelector('h3');
                    if (!nomeElement) {
                        console.error('Elemento h3 n√£o encontrado');
                        return;
                    }
                    const nome = nomeElement.textContent;

                    let endereco = '';

                    // Busca o endere√ßo em diferentes elementos dependendo do tipo de card
                    if (card.classList.contains('localizacao-card')) {
                        const enderecoElement = card.querySelector('.localizacao-info p:first-of-type');
                        endereco = enderecoElement ? enderecoElement.textContent : '';
                    } else if (card.classList.contains('farmacia-card')) {
                        const enderecoElement = card.querySelector('.farmacia-card-content p:first-of-type');
                        endereco = enderecoElement ? enderecoElement.textContent : '';
                    } else {
                        const enderecoElement = card.querySelector('.card-content p:first-of-type');
                        endereco = enderecoElement ? enderecoElement.textContent : '';
                    }

                    if (!endereco) {
                        console.error('Endere√ßo n√£o encontrado');
                        return;
                    }

                    // Tenta obter coordenadas
                    let coords = null;
                    if (card.dataset.lat && card.dataset.lng) {
                        coords = {
                            lat: parseFloat(card.dataset.lat),
                            lng: parseFloat(card.dataset.lng)
                        };
                        console.log('Coordenadas do data attribute:', coords);
                    } else {
                        console.log('Buscando coordenadas para:', endereco);
                        coords = await getCoordinates(endereco);
                        console.log('Coordenadas obtidas:', coords);
                    }

                    // Atualiza modal
                    tituloMapa.textContent = `Localiza√ß√£o: ${nome}`;
                    mapEndereco.textContent = `üìç ${endereco}`;

                    if (coords) {
                        const distancia = calcularDistancia(
                            institutoVitaCoords.lat, institutoVitaCoords.lng,
                            coords.lat, coords.lng
                        );
                        mapDistancia.textContent = `üìè Aproximadamente ${distancia.toFixed(1)} km do Instituto Vita`;
                    } else {
                        mapDistancia.textContent = 'üìè Dist√¢ncia n√£o dispon√≠vel';
                    }

                    // Mostra o modal
                    mapModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden'; // Previne scroll no body

                    // Ajusta a altura do mapa antes de criar
                    ajustarAlturaMapa();

                    // Remove mapa anterior
                    const mapContainer = document.getElementById('map');
                    if (map) {
                        map.remove();
                        map = null;
                    }
                    mapContainer.innerHTML = '<div class="loading">Carregando mapa...</div>';

                    // Se n√£o tem coordenadas, mostra mensagem de erro
                    if (!coords) {
                        mapContainer.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--cor-texto-secundario);">‚ùå N√£o foi poss√≠vel carregar o mapa para este endere√ßo.</div>';
                        return;
                    }

                    // Cria novo mapa com pequeno delay para garantir que o container esteja vis√≠vel
                    setTimeout(() => {
                        try {
                            map = L.map(mapContainer).setView([coords.lat, coords.lng], 15);

                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                                maxZoom: 19
                            }).addTo(map);

                            // Marcador do local
                            L.marker([coords.lat, coords.lng])
                                .addTo(map)
                                .bindPopup(`<b>${nome}</b><br>${endereco}`)
                                .openPopup();

                            // Marcador do Instituto Vita
                            L.marker([institutoVitaCoords.lat, institutoVitaCoords.lng], {
                                icon: L.divIcon({
                                    className: 'instituto-marker',
                                    html: '<div style="background: var(--verde-escuro); color: white; padding: 5px 10px; border-radius: 20px; font-weight: bold;">üè† Instituto Vita</div>',
                                    iconSize: [120, 40],
                                    iconAnchor: [60, 20]
                                })
                            }).addTo(map).bindPopup('<b>Instituto Vita</b><br>Av. Dr. En√©as Carvalho de Aguiar, 255');

                            // Linha conectando os pontos
                            const pontos = [
                                [institutoVitaCoords.lat, institutoVitaCoords.lng],
                                [coords.lat, coords.lng]
                            ];

                            L.polyline(pontos, {
                                color: 'var(--verde-medio)',
                                weight: 3,
                                opacity: 0.7,
                                dashArray: '10, 10'
                            }).addTo(map);

                            // Ajusta o zoom para mostrar ambos os pontos
                            const bounds = L.latLngBounds(pontos);
                            map.fitBounds(bounds, { padding: [50, 50] });

                            // Ajusta novamente ap√≥s o mapa carregar completamente
                            setTimeout(() => {
                                map.invalidateSize();
                            }, 300);

                        } catch (error) {
                            console.error('Erro ao criar mapa:', error);
                            mapContainer.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--cor-texto-secundario);">‚ùå Erro ao carregar o mapa. Por favor, tente novamente.</div>';
                        }
                    }, 100);
                });
            });
        });

        // Fun√ß√£o para geocodificar endere√ßo
        async function getCoordinates(address) {
            try {
                let cleanAddress = address
                    .replace(/Endere√ßo:/gi, '')
                    .replace(/[‚Äì‚Äî]/g, '-')
                    .trim();

                // Adiciona S√£o Paulo se n√£o estiver no endere√ßo
                if (!cleanAddress.toLowerCase().includes('s√£o paulo') && !cleanAddress.toLowerCase().includes('sp')) {
                    cleanAddress += ', S√£o Paulo, SP, Brasil';
                }

                console.log('Buscando coordenadas para:', cleanAddress);

                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(cleanAddress)}&addressdetails=1&limit=1&countrycodes=BR`;

                const response = await fetch(url, {
                    headers: {
                        'User-Agent': 'InstitutoVitaLocalizacao/1.0',
                        'Accept-Language': 'pt-BR'
                    }
                });

                if (!response.ok) {
                    console.error('Erro na resposta:', response.status, response.statusText);
                    throw new Error(`Erro: ${response.status}`);
                }

                const data = await response.json();
                console.log('Resposta da API:', data);

                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                }
                console.warn('Nenhum resultado encontrado para:', cleanAddress);
                return null;
            } catch (error) {
                console.error("Erro na geocodifica√ß√£o:", error);
                return null;
            }
        }

        // Fechar modal
        fecharMapa.onclick = () => {
            mapModal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restaura scroll no body
            if (map) {
                map.remove();
                map = null;
            }
        };

        // Fechar modal ao clicar fora
        window.onclick = e => {
            if (e.target === mapModal) {
                mapModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                if (map) {
                    map.remove();
                    map = null;
                }
            }
        };

        // Fechar modal com ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mapModal.style.display === 'flex') {
                mapModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                if (map) {
                    map.remove();
                    map = null;
                }
            }
        });

        // Redimensiona o mapa quando a janela √© redimensionada
        window.addEventListener('resize', ajustarAlturaMapa);

        // ==================== ANIMA√á√ÉO DE SCROLL ====================
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observa os cards para anima√ß√£o
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.card, .farmacia-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                observer.observe(card);
            });
        });

        // Debug: Verifica se os elementos foram encontrados
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Bot√µes mapa encontrados:', document.querySelectorAll('.mapa-sobre-img').length);
            console.log('Modal encontrado:', document.getElementById('mapModal'));
            console.log('Bot√£o fechar encontrado:', document.getElementById('fecharMapa'));
        });
    </script>

    <style>
        /* Estilos adicionais para o mapa */
        .instituto-marker {
            background: none !important;
            border: none !important;
        }

        .leaflet-popup-content {
            font-family: 'EB Garamond', serif;
            font-size: 1rem;
        }

        .leaflet-popup-content b {
            color: var(--verde-escuro);
            font-family: 'Cinzel Decorative', serif;
        }
    </style>
</body>

</html>