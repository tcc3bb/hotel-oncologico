<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funda√ß√£o Vita</title>
    <link rel="icon" href="/image/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=EB+Garamond&family=Uncial+Antiqua&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/admin/style_painel.css">
</head>

<body>
    <!--===================================================== MENU ============================================================-->
    <nav>
        <div class="nav-links">
            <a href="/" class="img">
                <img src="/image/logo.png" alt="Logo da Empresa" class="img-logo">
            </a>
            <a href="/nav/sobre-nos">Sobre n√≥s</a>
            <a href="/nav/sobre-cancer">Sobre o c√¢ncer</a>
            <a href="/nav/acomodacoes">Acomoda√ß√µes</a>
            <a href="/nav/apoio-paciente">Apoio ao paciente</a>
            <a href="/nav/localizacao">Localiza√ß√µes</a>
            <a href="/perguntas/perguntas-frequentes">Perguntas frequentes</a>
            <% if (!user) { %>
                <!-- Usu√°rio n√£o logado -->
                <a href="/usuarios/login" class="btn-entrar">Entrar</a>
                <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
                <% } else { %>
                    <!-- Usu√°rio logado -->
                    <% if (user.tipo==='paciente' ) { %>
                        <a href="/paciente/minhas-reservas" class="btn-nav">Minhas Reservas</a>
                        <% } else if (user.tipo==='acompanhante' ) { %>
                            <a href="/acompanhante/apoio-ao-paciente" class="btn-nav">Apoio ao Paciente</a>
                            <% } else if (user.tipo==='voluntario' ) { %>
                                <a href="/voluntario/area-do-voluntario" class="btn-nav">√Årea do Volunt√°rios</a>
                                <% } else if (user.tipo==='doador' ) { %>
                                    <a href="/doador/minhas-doacoes" class="btn-nav">Minhas Doa√ß√µes</a>
                                    <% } else if (user.tipo==='admin' ) { %>
                                        <a href="/admin/painel" class="btn-nav">Configura√ß√µes</a>
                                        <% } else { %>
                                            <!-- Caso algum outro tipo apare√ßa -->
                                            <a href="/usuarios/login" class="btn-entrar">Entrar</a>
                                            <a href="/usuarios/cadastro" class="btn-cadastrar">Cadastrar</a>
                                            <% } %>
                                                <!-- Bot√£o de logout -->
                                                <a href="/usuarios/logout" class="btn-logout">Sair</a>
                                                <% } %>
        </div>
    </nav>

    <div class="painel-container">
        <!--==================================================== SIDEBAR ==========================================================-->
        <aside class="sidebar">
            <div class="sidebar-item active" tabindex="0" data-target="usuarios">
                <span class="icon" aria-hidden="true">üë•</span>
                <span>Gest√£o de Usu√°rios</span>
            </div>
            <div class="sidebar-item" tabindex="0" data-target="reservas">
                <span class="icon" aria-hidden="true">üìÖ</span>
                <span>Gest√£o de Reservas</span>
            </div>
            <div class="sidebar-item" tabindex="0" data-target="conteudos">
                <span class="icon" aria-hidden="true">üìù</span>
                <span>Controle de Conte√∫do</span>
            </div>
            <div class="sidebar-item" tabindex="0" data-target="chat">
                <span class="icon">‚ùì</span>
                <span>Gest√£o do Chat</span>
            </div>
            <div class="sidebar-item" tabindex="0" data-target="doacoes">
                <span class="icon">üí∞</span>
                <span>Gest√£o de Doa√ß√µes</span>
            </div>
        </aside>

        <main>
            <!--============================================== GEST√ÉO DE USU√ÅRIOS =====================================================-->
            <section id="usuarios" class="conteudo ativo">
                <h2 class="section-title">Gest√£o de Usu√°rios</h2>
                <button class="btn-primary" type="button" onclick="location.href='/usuarios/cadastro'">
                    Adicionar usu√°rio
                </button>
                <table>
                    <thead>
                        <tr>
                            <th>E-mail</th>
                            <th>Perfil</th>
                            <th>Estado</th>
                            <th>Data de Cria√ß√£o</th>
                            <th>√öltimo Login</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% usuarios.forEach(function(usuario) { %>
                            <tr>
                                <td>
                                    <%= usuario.email %>
                                </td>
                                <td>
                                    <%= usuario.tipo.charAt(0).toUpperCase() + usuario.tipo.slice(1) %>
                                </td>
                                <td>
                                    <%= usuario.estado==='ativo' ? 'Ativo' : 'Inativo' %>
                                </td>
                                <td>
                                    <%= usuario.data_criacao || '-' %>
                                </td>
                                <td>
                                    <%= usuario.ultimo_login || '-' %>
                                </td>
                                <td class="acoes">
                                    <button type="button" class="btn-editar" data-id="<%= usuario.usuario_id %>"
                                        data-email="<%= usuario.email %>" data-tipo="<%= usuario.tipo %>"
                                        data-estado="<%= usuario.estado %>"
                                        onclick="abrirModalEdicao(this.dataset.id, this.dataset.email, this.dataset.tipo, this.dataset.estado)">
                                        ‚úèÔ∏è
                                    </button>
                                    <form action="/admin/usuarios/<%= usuario.usuario_id %>/delete" method="POST"
                                        style="display:inline;">
                                        <button type="button" class="delete"
                                            onclick="confirmDelete('<%= usuario.usuario_id %>', '<%= usuario.email %>')">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

                <!-- ==============================================-->
                <!--========== MODAL: EDITAR USU√ÅRIO ==============-->
                <!-- ==============================================-->
                <div id="modalEdicao" class="modal" style="display:none;">
                    <div class="modal-content">
                        <span class="close" onclick="fecharModalEdicao()">&times;</span>
                        <h3>Editar Usu√°rio</h3>
                        <form id="formEdicao" method="POST" enctype="multipart/form-data">
                            <input type="hidden" id="usuarioIdEdicao" name="id">

                            <label for="tipoEdicao">Tipo de Usu√°rio:</label>
                            <select id="tipoEdicao" name="tipo" required>
                                <option value="admin">Admin</option>
                                <option value="paciente">Paciente</option>
                                <option value="acompanhante">Acompanhante</option>
                                <option value="voluntario">Volunt√°rio</option>
                                <option value="doador">Doador</option>
                            </select>

                            <label for="estadoEdicao">Estado:</label>
                            <select id="estadoEdicao" name="estado" required>
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>

                            <label for="fotoPerfilEdicao">Foto de Perfil:</label>
                            <input type="file" id="fotoPerfilEdicao" name="foto_perfil" accept="image/*">

                            <div id="previewFoto" style="margin-top:10px;">
                                <img id="fotoPreviewImg" src="" alt="Pr√©via da foto"
                                    style="max-width:100px; display:none; border-radius:8px;">
                            </div>

                            <button type="submit" class="btn-primary" style="margin-top:15px;">Salvar
                                Altera√ß√µes</button>
                        </form>
                    </div>
                </div>
                <script>
                    function abrirModalEdicao(id, tipo, estado) {
                        document.getElementById('usuarioIdEdicao').value = id;
                        document.getElementById('tipoEdicao').value = tipo;
                        document.getElementById('estadoEdicao').value = estado;
                        document.getElementById('fotoPerfilEdicao').value = '';
                        document.getElementById('fotoPreviewImg').style.display = 'none';
                        const form = document.getElementById('formEdicao');
                        form.action = `/admin/usuarios/${id}/editar`;
                        document.getElementById('modalEdicao').style.display = 'block';
                    }
                    function fecharModalEdicao() {
                        document.getElementById('modalEdicao').style.display = 'none';
                    }
                    // Pr√©-visualiza√ß√£o da foto
                    document.getElementById('fotoPerfilEdicao').addEventListener('change', function (event) {
                        const file = event.target.files[0];
                        const imgPreview = document.getElementById('fotoPreviewImg');
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = e => {
                                imgPreview.src = e.target.result;
                                imgPreview.style.display = 'block';
                            };
                            reader.readAsDataURL(file);
                        } else {
                            imgPreview.style.display = 'none';
                        }
                    });
                </script>

                <!-- ==============================================-->
                <!--========== MODAL: SENHA PARA EXCLUIR ==========-->
                <!-- ==============================================-->
                <div id="modalSenha" class="modal" style="display:none;">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal()">&times;</span>
                        <h3>Confirme sua senha</h3>
                        <p>Para excluir o usu√°rio, digite sua senha:</p>
                        <form id="formDelete" method="POST">
                            <input type="password" name="senha" id="senhaAdmin" placeholder="Senha do admin" required>
                            <button type="submit">Confirmar</button>
                        </form>
                        <p id="erroSenha" style="color:red; display:none;">Senha incorreta</p>
                    </div>
                </div>
                <script>
                    let usuarioExcluirId = null;
                    function confirmDelete(usuarioId, usuarioEmail) {
                        usuarioExcluirId = usuarioId;
                        document.getElementById('senhaAdmin').value = '';
                        document.getElementById('erroSenha').style.display = 'none';
                        document.getElementById('formDelete').action = `/admin/usuarios/${usuarioId}/delete`;
                        document.getElementById('modalSenha').style.display = 'block';
                    }
                    function closeModal() {
                        document.getElementById('modalSenha').style.display = 'none';
                    }
                </script>

            </section>

            <!--============================================== GEST√ÉO DE RESERVAS =====================================================-->
            <section id="reservas" class="conteudo">
                <h2 class="section-title">Gest√£o de Reservas</h2>

                <!-- Bot√£o para abrir modal de nova reserva -->
                <button class="btn-primary" type="button" id="btnNovaReserva">+ Nova reserva</button>

                <!-- Filtros -->
                <div class="filtros" aria-label="Filtros de reservas">
                    <label for="data-reserva">Data:</label>
                    <input type="date" id="data-reserva" name="data-reserva" />

                    <label for="status-reserva">Status:</label>
                    <select id="status-reserva" name="status-reserva">
                        <option value="">Todos</option>
                        <option value="confirmada">Confirmada</option>
                        <option value="pendente">Pendente</option>
                        <option value="cancelada">Cancelada</option>
                        <option value="em_andamento">Em andamento</option>
                        <option value="concluida">Conclu√≠da</option>
                    </select>

                    <label for="usuario-reserva">Usu√°rio:</label>
                    <input type="text" id="usuario-reserva" name="usuario-reserva" placeholder="Nome do paciente" />
                </div>

                <!-- Lista de Reservas -->
                <table id="tabelaReservas">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Paciente</th>
                            <th>Quarto</th>
                            <th>Status</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% reservas.forEach(r=> { %>
                            <tr>
                                <td>
                                    <%= r.reserva_id %>
                                </td>
                                <td>
                                    <%= r.paciente_nome %>
                                </td>
                                <td>
                                    <%= r.quarto_numero %>
                                </td>
                                <td>
                                    <%= r.reserva_status %>
                                </td>
                                <td>
                                    <%= r.reserva_data_checkin_previsto.toLocaleDateString() %>
                                </td>
                                <td>
                                    <%= r.reserva_data_checkout_previsto.toLocaleDateString() %>
                                </td>
                                <td class="acoes">
                                    <button class="btnEditar" data-id="<%= r.reserva_id %>"
                                        data-status="<%= r.reserva_status %>" data-paciente="<%= r.paciente_id %>"
                                        data-quarto="<%= r.quarto_id %>"
                                        data-checkin="<%= r.reserva_data_checkin_previsto.toISOString().slice(0,16) %>"
                                        data-checkout="<%= r.reserva_data_checkout_previsto.toISOString().slice(0,16) %>"
                                        data-motivo="<%= r.reserva_motivo || '' %>">
                                        ‚úèÔ∏è
                                    </button>
                                    <a href="/reservas/deletar/<%= r.reserva_id %>" class="btn-delete"
                                        onclick="return confirm('Excluir reserva?')">üóëÔ∏è</a>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

                <!-- ============== MODAL: NOVA RESERVA ================= -->
                <div id="modalNovaReserva" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h3>Nova Reserva</h3>
                        <form action="/reservas/nova" method="POST">
                            <label>Paciente ID:</label>
                            <input type="number" name="paciente_id" required>

                            <label>Quarto ID:</label>
                            <input type="number" name="quarto_id" required>

                            <label>Check-in previsto:</label>
                            <input type="datetime-local" name="reserva_data_checkin_previsto" required>

                            <label>Check-out previsto:</label>
                            <input type="datetime-local" name="reserva_data_checkout_previsto" required>

                            <label>Motivo da estadia:</label>
                            <textarea name="reserva_motivo"></textarea>

                            <button type="submit" class="btn-primary">Salvar</button>
                        </form>
                    </div>
                </div>

                <!-- ============== MODAL: EDITAR RESERVA ================= -->
                <div id="modalEditarReserva" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h3>Editar Reserva</h3>
                        <form id="formEditarReserva" method="POST">
                            <label>Status:</label>
                            <select name="reserva_status">
                                <option value="pendente">Pendente</option>
                                <option value="confirmada">Confirmada</option>
                                <option value="em_andamento">Em andamento</option>
                                <option value="concluida">Conclu√≠da</option>
                                <option value="cancelada">Cancelada</option>
                            </select>

                            <label>Check-in previsto:</label>
                            <input type="datetime-local" name="reserva_data_checkin_previsto" required>

                            <label>Check-out previsto:</label>
                            <input type="datetime-local" name="reserva_data_checkout_previsto" required>

                            <label>Motivo:</label>
                            <textarea name="reserva_motivo"></textarea>

                            <button type="submit" class="btn-primary">Salvar altera√ß√µes</button>
                        </form>
                    </div>
                </div>

                <!-- ============== SCRIPT DOS MODAIS ================= -->
                <script>
                    // Abrir e fechar modais
                    const modalNova = document.getElementById("modalNovaReserva");
                    const modalEditar = document.getElementById("modalEditarReserva");
                    const btnNova = document.getElementById("btnNovaReserva");
                    const closeButtons = document.querySelectorAll(".close");

                    btnNova.onclick = () => modalNova.style.display = "block";
                    closeButtons.forEach(btn => btn.onclick = () => {
                        modalNova.style.display = "none";
                        modalEditar.style.display = "none";
                    });

                    window.onclick = (event) => {
                        if (event.target === modalNova) modalNova.style.display = "none";
                        if (event.target === modalEditar) modalEditar.style.display = "none";
                    };

                    // Preencher modal de edi√ß√£o dinamicamente
                    document.querySelectorAll(".btnEditar").forEach(btn => {
                        btn.addEventListener("click", () => {
                            const id = btn.dataset.id;
                            const form = document.getElementById("formEditarReserva");
                            form.action = `/reservas/editar/${id}`;
                            form.reserva_status.value = btn.dataset.status;
                            form.reserva_data_checkin_previsto.value = btn.dataset.checkin;
                            form.reserva_data_checkout_previsto.value = btn.dataset.checkout;
                            form.reserva_motivo.value = btn.dataset.motivo;
                            modalEditar.style.display = "block";
                        });
                    });
                </script>

            </section>

            <!--============================================== GEST√ÉO DE CONTE√öDOS ====================================================-->
            <section id="conteudos" class="conteudo">
                <h2 class="section-title">Gest√£o de Conte√∫do</h2>
                <% if (user && user.tipo==='admin' ) { %>
                    <button class="btn-primary" type="button" onclick="abrirModalNovo()">‚ûï Novo Artigo</button>
                    <% } %>

                        <table>
                            <thead>
                                <tr>
                                    <th>T√≠tulo</th>
                                    <th>Categoria</th>
                                    <th>Status</th>
                                    <th>Data Publica√ß√£o</th>
                                    <th>Visualiza√ß√µes</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% artigos.forEach(artigo=> { %>
                                    <tr>
                                        <td>
                                            <%= artigo.artigo_titulo %>
                                        </td>
                                        <td>
                                            <%= artigo.artigo_categoria || '-' %>
                                        </td>
                                        <td>
                                            <%= artigo.artigo_status %>
                                        </td>
                                        <td>
                                            <%= artigo.artigo_data_publicacao ? new
                                                Date(artigo.artigo_data_publicacao).toLocaleDateString() : '-' %>
                                        </td>
                                        <td>
                                            <%= artigo.artigo_visualizacoes || 0 %>
                                        </td>
                                        <td class="acoes">
                                            <button class="btn-primary" type="button" data-id="<%= artigo.artigo_id %>"
                                                onclick="abrirModalEditarArtigo(this.dataset.id)">‚úèÔ∏è</button>
                                            <form action="/admin/artigos/<%= artigo.artigo_id %>/delete" method="post"
                                                style="display:inline">
                                                <button type="submit" class="delete" title="Excluir">üóëÔ∏è</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <% }) %>
                            </tbody>
                        </table>

                        <!-- ============================================================================-->
                        <!--========================== MODAL: NOVO ARTIGO ===============================-->
                        <!--============================================================================ -->
                        <div id="modalNovoArtigo" class="modal" style="display:none;">
                            <div class="modal-content">
                                <span class="close" onclick="fecharModalNovo()">&times;</span>
                                <h3>Novo Artigo</h3>

                                <form action="/admin/artigos/novo" method="POST"
                                    enctype="multipart/form-data">

                                    <label for="artigo_titulo">T√≠tulo:</label>
                                    <input type="text" id="artigo_titulo" name="artigo_titulo" required>

                                    <label for="artigo_subtitulo">Subt√≠tulo:</label>
                                    <input type="text" id="artigo_subtitulo" name="artigo_subtitulo">

                                    <label for="artigo_categoria">Categoria:</label>
                                    <input type="text" id="artigo_categoria" name="artigo_categoria"
                                        placeholder="Ex: Sa√∫de, Psicologia...">

                                    <label for="artigo_resumo">Resumo:</label>
                                    <textarea id="artigo_resumo" name="artigo_resumo" rows="3" required></textarea>

                                    <label for="artigo_conteudo">Conte√∫do completo:</label>
                                    <textarea id="artigo_conteudo" name="artigo_conteudo" rows="8" required></textarea>

                                    <label for="artigo_palavras_chave">Palavras-chave:</label>
                                    <input type="text" id="artigo_palavras_chave" name="artigo_palavras_chave"
                                        placeholder="separadas por v√≠rgula">

                                    <label for="artigo_slug">Slug (URL amig√°vel):</label>
                                    <input type="text" id="artigo_slug" name="artigo_slug"
                                        placeholder="ex: cuidados-pos-cirurgia">

                                    <label for="artigo_imagem_capa">Imagem de capa:</label>
                                    <input type="file" id="artigo_imagem_capa" name="artigo_imagem_capa"
                                        accept="image/*">

                                    <div id="previewCapa" style="margin-top:10px;">
                                        <img id="capaPreviewImg" src="" alt="Pr√©via da capa"
                                            style="max-width:150px; display:none; border-radius:8px;">
                                    </div>

                                    <button type="submit" class="btn-primary" style="margin-top:15px;">Salvar
                                        Artigo</button>
                                </form>
                            </div>
                        </div>
                        <script>
                            /* =========================================================================================================== */
                            /* ======================================== SCRIPT: NOVO ARTIGO ============================================== */
                            /* =========================================================================================================== */
                            // Abrir modal de novo artigo
                            function abrirModalNovo() {
                                document.getElementById('modalNovoArtigo').style.display = 'block';
                                document.getElementById('formNovoArtigo').reset();
                                document.getElementById('capaPreviewImg').style.display = 'none';
                            }
                            // Fechar modal
                            function fecharModalNovo() {
                                document.getElementById('modalNovoArtigo').style.display = 'none';
                            }
                            // Pr√©-visualiza√ß√£o da imagem de capa
                            document.getElementById('artigo_imagem_capa').addEventListener('change', function (event) {
                                const file = event.target.files[0];
                                const imgPreview = document.getElementById('capaPreviewImg');
                                if (file) {
                                    const reader = new FileReader();
                                    reader.onload = e => {
                                        imgPreview.src = e.target.result;
                                        imgPreview.style.display = 'block';
                                    };
                                    reader.readAsDataURL(file);
                                } else {
                                    imgPreview.style.display = 'none';
                                }
                            });
                            // Fechar o modal clicando fora dele
                            window.addEventListener('click', function (event) {
                                const modal = document.getElementById('modalNovoArtigo');
                                if (event.target === modal) {
                                    fecharModalNovo();
                                }
                            });
                        </script>
                        <script>
                            /* ======================================================================== */
                            /* ======================= SCRIPT: EDITAR ARTIGO ========================== */
                            /* ======================================================================== */
                            async function abrirModalEditarArtigo(id) {
                                try {
                                    const response = await fetch(`/admin/artigos/${id}`);
                                    if (!response.ok) throw new Error('Erro ao buscar o artigo.');
                                    const artigo = await response.json();

                                    // Abre o modal
                                    const modal = document.getElementById('modalNovoArtigo');
                                    modal.style.display = 'block';
                                    modal.querySelector('h3').innerText = 'Editar Artigo';

                                    // Preenche os campos
                                    document.getElementById('artigo_titulo').value = artigo.artigo_titulo || '';
                                    document.getElementById('artigo_subtitulo').value = artigo.artigo_subtitulo || '';
                                    document.getElementById('artigo_categoria').value = artigo.artigo_categoria || '';
                                    document.getElementById('artigo_resumo').value = artigo.artigo_resumo || '';
                                    document.getElementById('artigo_palavras_chave').value = artigo.artigo_palavras_chave || '';
                                    document.getElementById('artigo_slug').value = artigo.artigo_slug || '';

                                    // üîπ Espera o TinyMCE estar pronto antes de setar o conte√∫do
                                    const editor = tinymce.get('artigo_conteudo');
                                    if (editor) {
                                        editor.setContent(artigo.artigo_conteudo || '');
                                    } else {
                                        tinymce.once('AddEditor', () => {
                                            tinymce.get('artigo_conteudo').setContent(artigo.artigo_conteudo || '');
                                        });
                                    }

                                    // Mostra a imagem de capa, se existir
                                    const preview = document.getElementById('capaPreviewImg');
                                    if (artigo.artigo_imagem_capa) {
                                        preview.src = artigo.artigo_imagem_capa;
                                        preview.style.display = 'block';
                                    } else {
                                        preview.style.display = 'none';
                                    }

                                    // Define o action do formul√°rio como PUT
                                    const form = document.getElementById('formNovoArtigo');
                                    form.action = `/admin/artigos/${id}?_method=PUT`;

                                } catch (err) {
                                    console.error('Erro ao abrir modal de edi√ß√£o:', err);
                                    alert('N√£o foi poss√≠vel carregar o artigo para edi√ß√£o.');
                                }
                            }
                        </script>

                        <script
                            src="https://cdn.tiny.cloud/1/dap6c3mpzxaz4rfmtgm5rr0za2vkn7k17uwv3zsqfpn908g1/tinymce/6/tinymce.min.js"
                            referrerpolicy="origin"></script>
                        <script>
                            tinymce.init({
                                selector: '#artigo_conteudo',
                                height: 400,
                                menubar: false,
                                plugins: 'advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table code help wordcount',
                                toolbar: 'undo redo | formatselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
                                content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
                            });
                        </script>

            </section>

            <!--================================================ GEST√ÉO DO CHAT =======================================================-->
            <section id="chat" class="conteudo">
                <h2 class="section-title">Gest√£o do Chat</h2>
                <% if (perguntas && perguntas.length> 0) { %>
                    <% perguntas.forEach(function(p) { %>
                        <div class="chat-pergunta">
                            <p><strong>P:</strong>
                                <%= p.pergunta_titulo %>
                            </p>
                            <p>
                                <%= p.pergunta_conteudo %>
                            </p>
                            <small>Por <%= p.autor_nome %> em <%= p.pergunta_data_criacao %></small>
                            <% if (p.respostas && p.respostas.length> 0) { %>
                                <div class="chat-respostas" style="margin-left:20px; margin-top:10px;">
                                    <% p.respostas.forEach(function(r) { %>
                                        <p><strong>R:</strong>
                                            <%= r.resposta_conteudo %>
                                        </p>
                                        <small>Por <%= r.autor_nome %> em <%= r.resposta_data_criacao %></small>
                                        <% }) %>
                                </div>
                                <% } else { %>
                                    <p style="margin-left:20px; color:gray;">Sem respostas</p>
                                    <% } %>
                                        <hr>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <p>Nenhuma pergunta cadastrada.</p>
                                <% } %>
            </section>

            <!--============================================== GEST√ÉO DE DOA√á√ïES ======================================================-->
            <section id="doacoes" class="conteudo">
                <h2 class="section-title">Gest√£o de Doa√ß√µes</h2>

                <!-- Bot√£o de nova doa√ß√£o -->
                <button class="btn-primary" type="button" id="btnNovaDoacao">+ Registrar Doa√ß√£o</button>

                <!-- Filtros -->
                <div class="filtros">
                    <label for="filtroTipo">Tipo:</label>
                    <select id="filtroTipo">
                        <option value="">Todos</option>
                        <option value="financeira">Financeira</option>
                        <option value="alimento">Alimento</option>
                        <option value="roupa">Roupas</option>
                        <option value="higiene">Higiene</option>
                    </select>

                    <label for="filtroMes">M√™s:</label>
                    <select id="filtroMes">
                        <option value="">Todos</option>
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Mar√ßo</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>

                    <label for="filtroAno">Ano:</label>
                    <input type="number" id="filtroAno" placeholder="2025">

                    <button id="btnAplicarFiltros" class="btn-primary" type="button">Aplicar filtros</button>
                    <button id="btnLimparFiltros" class="btn-secondary" type="button">Limpar</button>
                </div>

                <!-- Lista de doa√ß√µes -->
                <table id="tabelaDoacoes">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Doador</th>
                            <th>Tipo</th>
                            <th>Valor/Descri√ß√£o</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>

                    <tbody>
                        <% if (doacoes && doacoes.length> 0) { %>
                            <% doacoes.forEach(d=> { %>
                                <tr>
                                    <td>
                                        <%= d.doacao_id %>
                                    </td>
                                    <td>
                                        <%= d.doador_nome %>
                                    </td>
                                    <td>
                                        <%= d.doacao_tipo %>
                                    </td>
                                    <td>
                                        <% if (d.doacao_valor) { %>
                                            R$ <%= d.doacao_valor %>
                                                <% } else { %>
                                                    <%= d.doacao_categoria_item || d.doacao_info || "‚Äî" %>
                                                        <% } %>
                                    </td>
                                    <td>
                                        <%= new Date(d.doacao_data).toLocaleDateString("pt-BR") %>
                                    </td>
                                    <td>
                                        <%= d.doacao_status %>
                                    </td>

                                    <td class="acoes">
                                        <button class="btnEditarDoacao" data-id="<%= d.doacao_id %>"
                                            data-tipo="<%= d.doacao_tipo %>"
                                            data-info="<%= d.doacao_info || d.doacao_valor %>"
                                            data-status="<%= d.doacao_status %>"
                                            data-data="<%= d.doacao_data.toISOString() %>">
                                            ‚úèÔ∏è
                                        </button>

                                        <a href="/admin/doacoes/deletar/<%= d.doacao_id %>" class="btn-delete"
                                            onclick="return confirm('Excluir doa√ß√£o?')">üóëÔ∏è</a>
                                    </td>
                                </tr>
                                <% }) %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="7">Nenhuma doa√ß√£o encontrada.</td>
                                        </tr>
                                        <% } %>
                    </tbody>

                </table>

                <!-- ============== MODAL NOVA DOA√á√ÉO ================= -->
                <div id="modalNovaDoacao" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h3>Registrar Doa√ß√£o</h3>
                        <form action="/admin/doacoes/nova" method="POST">

                            <label>Doador ID:</label>
                            <input type="number" name="doador_id" required>

                            <label>Tipo:</label>
                            <select name="doacao_tipo" required>
                                <option value="financeira">Financeira</option>
                                <option value="alimento">Alimento</option>
                                <option value="roupa">Roupas</option>
                                <option value="higiene">Higiene</option>
                            </select>

                            <label>Valor / Descri√ß√£o:</label>
                            <input type="text" name="doacao_info" required>

                            <label>Data:</label>
                            <input type="datetime-local" name="doacao_data" required>

                            <label>Status:</label>
                            <select name="doacao_status">
                                <option value="confirmada">Confirmada</option>
                                <option value="pendente">Pendente</option>
                                <option value="cancelada">Cancelada</option>
                            </select>

                            <button class="btn-primary" type="submit">Salvar</button>
                        </form>
                    </div>
                </div>

                <!-- ============== MODAL EDITAR DOA√á√ÉO ================= -->
                <div id="modalEditarDoacao" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h3>Editar Doa√ß√£o</h3>
                        <form id="formEditarDoacao" method="POST">

                            <label>Tipo:</label>
                            <select name="doacao_tipo">
                                <option value="financeira">Financeira</option>
                                <option value="alimento">Alimento</option>
                                <option value="roupa">Roupas</option>
                                <option value="higiene">Higiene</option>
                            </select>

                            <label>Valor / Descri√ß√£o:</label>
                            <input type="text" name="doacao_info" required>

                            <label>Data:</label>
                            <input type="datetime-local" name="doacao_data" required>

                            <label>Status:</label>
                            <select name="doacao_status">
                                <option value="confirmada">Confirmada</option>
                                <option value="pendente">Pendente</option>
                                <option value="cancelada">Cancelada</option>
                            </select>

                            <button class="btn-primary" type="submit">Salvar Altera√ß√µes</button>
                        </form>
                    </div>
                </div>

                <script>
                    const modalNovaDoacao = document.getElementById("modalNovaDoacao");
                    const modalEditarDoacao = document.getElementById("modalEditarDoacao");

                    const btnNovaDoacao = document.getElementById("btnNovaDoacao");
                    const closeBtnsDoacao = modalNovaDoacao.querySelector(".close").onclick =
                        modalEditarDoacao.querySelector(".close").onclick =
                        function () {
                            modalNovaDoacao.style.display = "none";
                            modalEditarDoacao.style.display = "none";
                        };

                    btnNovaDoacao.onclick = () => modalNovaDoacao.style.display = "block";

                    // Preencher modal de edi√ß√£o
                    document.querySelectorAll(".btnEditarDoacao").forEach(btn => {
                        btn.onclick = () => {
                            const form = document.getElementById("formEditarDoacao");

                            form.action = `/admin/doacoes/editar/${btn.dataset.id}`;
                            form.doacao_tipo.value = btn.dataset.tipo;
                            form.doacao_info.value = btn.dataset.info;
                            form.doacao_status.value = btn.dataset.status;
                            form.doacao_data.value = btn.dataset.data;

                            modalEditarDoacao.style.display = "block";
                        };
                    });

                    window.onclick = (event) => {
                        if (event.target === modalNovaDoacao) modalNovaDoacao.style.display = "none";
                        if (event.target === modalEditarDoacao) modalEditarDoacao.style.display = "none";
                    };
                </script>

                <script>
                    // ============================
                    // FILTROS DE DOA√á√ïES (FRONT-END)
                    // ============================

                    const filtroTipo = document.getElementById("filtroTipo");
                    const filtroMes = document.getElementById("filtroMes");
                    const filtroAno = document.getElementById("filtroAno");

                    const btnAplicar = document.getElementById("btnAplicarFiltros");
                    const btnLimpar = document.getElementById("btnLimparFiltros");

                    const linhas = document.querySelectorAll("#tabelaDoacoes tbody tr");

                    function aplicarFiltros() {
                        const tipo = filtroTipo.value;
                        const mes = filtroMes.value;
                        const ano = filtroAno.value.trim();

                        linhas.forEach(tr => {
                            const tds = tr.querySelectorAll("td");

                            if (tds.length === 1) return; // ignora ‚ÄúNenhuma doa√ß√£o encontrada‚Äù

                            const tipoTD = tds[2].textContent.trim().toLowerCase();
                            const dataTD = tds[4].textContent.trim(); // formato BR: dd/mm/yyyy

                            const [dia, mesBR, anoBR] = dataTD.split("/");

                            let mostrar = true;

                            // Filtro por tipo
                            if (tipo && tipoTD !== tipo.toLowerCase()) {
                                mostrar = false;
                            }

                            // Filtro por m√™s
                            if (mes && Number(mesBR) !== Number(mes)) {
                                mostrar = false;
                            }

                            // Filtro por ano
                            if (ano && Number(anoBR) !== Number(ano)) {
                                mostrar = false;
                            }

                            tr.style.display = mostrar ? "" : "none";
                        });
                    }

                    // Bot√£o aplicar
                    btnAplicar.onclick = aplicarFiltros;

                    // Bot√£o limpar
                    btnLimpar.onclick = () => {
                        filtroTipo.value = "";
                        filtroMes.value = "";
                        filtroAno.value = "";
                        linhas.forEach(tr => tr.style.display = "");
                    };
                </script>

            </section>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const sidebarItems = document.querySelectorAll('.sidebar-item');
                    const contentSections = document.querySelectorAll('.conteudo');

                    // 1. Fun√ß√£o para mostrar o conte√∫do e definir o item ativo
                    function showContent(targetId) {
                        // Oculta todas as se√ß√µes de conte√∫do
                        contentSections.forEach(section => {
                            section.classList.remove('ativo');
                        });

                        // Remove a classe 'active' de todos os itens da sidebar
                        sidebarItems.forEach(item => {
                            item.classList.remove('active');
                        });

                        // Mostra a se√ß√£o alvo e define o item da sidebar como ativo
                        const targetSection = document.getElementById(targetId);
                        if (targetSection) {
                            targetSection.classList.add('ativo');
                        }

                        // Encontra e ativa o item da sidebar correspondente
                        const activeSidebarItem = document.querySelector(`.sidebar-item[data-target="${targetId}"]`);
                        if (activeSidebarItem) {
                            activeSidebarItem.classList.add('active');
                        }
                    }

                    // 2. Adiciona o listener de evento para cada item da sidebar
                    sidebarItems.forEach(item => {
                        item.addEventListener('click', function () {
                            const targetId = this.dataset.target; // Obt√©m o valor do atributo data-target
                            showContent(targetId);
                        });
                    });

                    // 3. Inicializa: Garante que apenas a se√ß√£o marcada como 'ativo' no HTML esteja vis√≠vel ao carregar.
                    // Se nenhuma estiver marcada no HTML, ele mostra a primeira.
                    const initialActiveSection = document.querySelector('.conteudo.ativo');
                    if (!initialActiveSection && contentSections.length > 0) {
                        showContent(contentSections[0].id);
                    }
                });
            </script>


</body>

</html>